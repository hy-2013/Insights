---
{"dg-publish":true,"permalink":"/040 Plan/Phoenix/LLM Pretrain/","tags":["#LLM/Pretrain"]}
---

æ€è€ƒï¼š
1. LLMä¸»è¦ç©å®¶`3ä¸ª2`ï¼š2ï¼ˆmetaã€deepmindï¼‰+2ï¼ˆqwen+deepseekï¼‰+2ï¼ˆopenaiã€anthropicï¼‰+å…¶ä»–ï¼ˆnvã€allenAIã€é«˜æ ¡ï¼‰
	1. æ–¹å‘æˆ–æ€æƒ³ï¼š**deepmind**ã€metaã€openaiã€anthropicã€Stanford/CMU/MITã€MSRAã€æ¸…å
	2. å¼€æºï¼š
		1. å›½å¤–ï¼š**metaã€olmo**ï¼ˆallan aiï¼‰ã€**nv**ã€gemmaã€mistral
			1. phiã€cohereã€AI21 Labsã€Appleã€NexusFlow
		2. å›½å†…ï¼š**qwenã€Deepseek**
			1. glmã€InternLM
	3. é—­æºï¼š
		1. å›½å¤–ï¼šoaiã€anthropicã€Geminiã€grok
			1. Reka AI
		2. å›½å†…ï¼šå­—èŠ‚ã€ç™¾åº¦ã€å¿«æ‰‹ã€å…­å°é¾™ã€è…¾è®¯
2. å¦‚ä½•åšçŸ¥è¯†æ³¨å…¥ï¼Ÿ
	1. Richard Suttonçš„online learningï¼ŒLecunçš„world model
3. å¦‚ä½•ç³»ç»Ÿæé«˜reasonã€mathå’ŒPlanningçš„èƒ½åŠ›ï¼Ÿ
	1. æ¸…æ´—ã€æ ¼å¼åŒ–ã€ç”Ÿæˆé«˜è´¨é‡mathå’Œcodingæ•°æ®
	2. å¤–éƒ¨ç³»ç»Ÿå·¥å…·
	3. let verify step by step
4. ä¸ºå•¥æ¯”baichuan2å·®ï¼šTokenæ•°1.1T:2.6Tï¼Œä¸­æ–‡è´¨é‡ä¸è¶³ï¼Œåˆ·åˆ†trickã€‚
5. Scaling lawé¢„æµ‹å‡ºlosså€¼åçš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
	1. ä¸åŒNç›¸åŒlossï¼Œtask performanceä¹Ÿä¸åŒï¼ˆæ¯”å¦‚34b 5wæ­¥å’Œ1.5bè®­å®Œçš„lossä¸€æ ·ï¼Œä½†performanceæ¯”1.5bå·®ï¼‰ï¼Œ5wæ­¥çš„34bè®­ç»ƒä¸å……åˆ†ã€‚æ‰€ä»¥é‡è¦æ€§ï¼šD>N>è¶…å‚ï¼Ÿ
	2. ~~Nå’ŒDéƒ½ç›¸åŒï¼Œlossç›¸è¿‘ï¼Œä½†task performanceä¹Ÿå·®åˆ«å¾ˆå¤§ã€‚~~ï¼ˆwsd task62æ˜¯æ¯”task42çš„task performanceæ›´å¥½äº›ï¼‰
	3. losså€¼å’Œtask performanceçš„å…³ç³»ä¸æ¸…æ¥šï¼Œæœ€å¤šæœ‰ä¸€å®šçš„æ­£ç›¸å…³æ€§
	4. transformerç»“æ„ï¼šC=6ND
	5. ä»·å€¼ï¼šç»™å®šè®­ç»ƒæ—¶é—´å’Œè®­ç»ƒèµ„æºçš„å‰æä¸‹ï¼ˆdeadlineï¼‰ï¼Œè®¡ç®—æœ€ä¼˜losså¯¹åº”çš„Nå’ŒDã€‚ï¼ˆä½†å¤§ä¸€ç‚¹lossçš„ã€Œå¤§Då°Nã€å°±æ¯”å°ä¸€ç‚¹lossçš„ã€Œå°Då¤§Nã€ä¸‹æ¸¸task performanceæ›´å·®å—ï¼Ÿï¼‰
6. å¤§æ¨¡å‹çš„online learningï¼šæŸä¸ªåœºæ™¯ç»™äº†å°‘é‡é«˜è´¨é‡çš„çŸ¥è¯†çš„æ•°æ®ï¼Œå¦‚ä½•å¯é ä¸”å…¨è‡ªåŠ¨çš„å°†è¿™äº›çŸ¥è¯†è®­å…¥åŸºåº§ã€‚æ— è®ºæ˜¯æ‰©å¢æ•°æ®è¿˜æ˜¯å…¶ä»–æ–¹å¼ã€‚
7. åŸºäºéŸ³é¢‘çš„Sunoï¼Œ åŸºäºè§†é¢‘çš„Soraï¼ŒåŸºäºæ–‡å­—çš„LLMï¼ŒåŸºäºæ£‹ç›˜çš„AlphaGO
	1. TBçº§çš„é«˜è´¨é‡æ ‡æ³¨ï¼ˆåŒ…æ‹¬è‡ªç›‘ç£ï¼‰æ•°æ®ï¼šæœ¬æ¥å°±æœ‰ã€åˆæˆæˆ–è‡ªè¿­ä»£äº¤äº’ç”Ÿæˆï¼ŒåŒ…æ‹¬ ç»Ÿä¸€çš„æ•°æ®è¡¨ç¤ºæ–¹æ³•ï¼ˆtokenizerï¼‰
	2. å¯scaleçš„æ¨¡å‹æ¶æ„ï¼štransformerã€‚ä»»åŠ¡çš„ç»„åˆç©ºé—´è¦è¶³å¤Ÿå¤§ï¼Œæ‹Ÿåˆçš„å‡½æ•°è¦è¶³å¤Ÿå¤æ‚
	3. å¯scaleä¸”æ˜ç¡®çš„ä¼˜åŒ–ç›®æ ‡ï¼ˆå¦‚PNTï¼Œpredict next tokenï¼‰
	4. å•†ä¸šä»·å€¼è¶³å¤Ÿå¤§ & ä¸ºä»€ä¹ˆæ˜¯ä½ åšï¼Ÿ
8. è‡ªç ”ç‰¹è‰²ï¼šå°sizeï¼ˆä¸è¶…è¿‡34bï¼‰
	1. åŠ©æ‰‹ä¸“ç”¨LLMï¼šä¸­æ–‡ç†è§£ã€æŒ‡ä»¤éµå¾ªå’Œlong Context
	2. å‡ºè¡ŒPlanning
	3. å¸ä¹˜LBSæƒ…æ„Ÿé™ªä¼´
	4. ä¸“ä¸šèƒ½åŠ›ï¼šæ•°å­¦ã€æ¨ç†
	5. å¤šæ¨¡æ€ï¼šå’Œæ¡”è§†ã€æ— äººè½¦ç­‰ä¸šåŠ¡ç»“åˆ
9. å…³äºå¢åŠ ä¸­æ–‡tokençš„é¢„è®­ç»ƒï¼š
	1. åŠ ä¸­æ–‡è¯è¡¨åŠ ä¸­æ–‡æ•°æ®æ¯”ä¾‹äºŒé˜¶æ®µè®­ï¼Œä¼šæ¯”ä¸­è‹±åˆç†æ¯”ä¾‹from scratchè®­å·®å¤šå°‘ï¼Ÿ
	2. Llama 3 è¯è¡¨ä¸­æ–‡tokenå¤§æ¦‚3.9kï¼Œä¸è€ƒè™‘æ¨ç†æ•ˆç‡ï¼Œåªè€ƒè™‘æœ€ç»ˆæ•ˆæœï¼Œä½ ä»¬è§‰å¾—åº”è¯¥åŠ è¯è¡¨å—ï¼Ÿ
	3. å¢é‡è®­åº”è¯¥æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ
		1. æ•°æ®åˆ†å¸ƒçš„é€æ­¥è°ƒæ•´ã€å¢åŠ ä¸­æ–‡å æ¯”ï¼šwarmup
		2. replayæ¯”ä¾‹å’Œä¸­è‹±æ–‡æ¯”ä¾‹
		3. lr Scheduler
10. ä¸€äº›åŸåˆ™ï¼šArmen Aghajanyanå’Œ[Hyung Won Chung](https://x.com/hwchung27/status/1800676312916656592)
	![Pasted image 20240630185731.png](/img/user/990%20Attachment/Pasted%20image%2020240630185731.png)
   ![Pasted image 20240630185639.png](/img/user/990%20Attachment/Pasted%20image%2020240630185639.png)
   ![Pasted image 20240630185828.png](/img/user/990%20Attachment/Pasted%20image%2020240630185828.png)ï¼šéšç€ç®—åŠ›å¢é•¿ï¼Œéœ€è¦ä¸æ–­å¯»æ‰¾æœ€é€‚åˆçš„structureï¼ˆmodelå’Œlossï¼‰ï¼Œmore scalable and simle structure
	1. llmçš„æ ¸å¿ƒè¦ç´ ï¼šå¯»æ‰¾**æœ€é€‚åˆå½“å‰computeå’Œdataçš„end-to-end scalable structure**
		1. computeï¼šGPUå’Œå¤šæœºå¤šå¡ï¼ˆInfraï¼‰
		2. dataï¼šdata infraï¼ˆå…¨äººç±»æ•°æ®æ•°å­—åŒ–ï¼‰å’Œtokenizer
		3. learning objectivesï¼šAEåˆ°ARï¼ˆdecode-onlyï¼‰ã€‚å¯»æ‰¾scaleæ›´å¥½çš„loss
		4. architecturesï¼šenc-dec -> encoder -> decoder (share params of enc and dec)
11. å¤šå¡è¶…å‚ï¼š
	1. å°å‚æ•°é‡modelï¼šä¼˜å…ˆDPå’ŒTPï¼Œåé¢è°ƒPPï¼ŒPPå®¹æ˜“äº§ç”Ÿæ°”æ³¡
		1. `--tensor-model-parallel-size 4 --pipeline-model-parallel-size 4 \`
	2. TPç²¾åº¦å½±å“è¿™ä¸ªæ˜¯ä¸å¯é¿å…çš„ï¼Œæµ®ç‚¹æ•°ç‰¹æ€§
	3. æ˜¾å­˜éœ€è¦ï¼š
		1. è®­ç»ƒï¼šæ¨¡å‹sizeçš„20å€+
		2. æ¨ç†ï¼šæ¨¡å‹sizeçš„ä¸¤å€+ï¼ˆfp16+kv cacheï¼‰
12. çŸ¥è¯†ç±»éœ€è¦é‡‡è´­ï¼Œmathå’Œcodeå¯ä»¥åˆæˆ
13. å°æ¨¡å‹çš„çŸ¥è¯†è®°å¿†é—®é¢˜å¯ä»¥è€ƒRAGæˆ–long contextæ¥æ¥ï¼Œä¸“æ³¨äºä¼˜åŒ–æ¨ç†å’Œmathå³å¯ï¼Ÿ
	1. å¤§æ¨¡å‹å¤šå‡ºæ¥å‚æ•°åªæ˜¯ç”¨äºè®°å¿†å—ï¼Ÿï¼ˆæ˜¾ç„¶ä¸æ˜¯ï¼‰
14. doremiçš„é—®é¢˜ï¼Ÿ
	1. losså¯¼å‘è€Œä¸æ˜¯metrics
	2. æ— æ³•åŒºåˆ†hardå’Œå™ªå£°
	3. è¦å¢åŠ çš„dataç±»å‹æœªå¿…å°±æœ‰
15. å»é‡çš„å¿…è¦æ€§è°ƒç ”ï¼š
	1. ç®—åŠ›æœ‰é™çš„æƒ…å†µä¸‹ï¼šæœ¬è´¨æ˜¯å¤šæ ·æ€§æ›´é‡è¦è¿˜æ˜¯è´¨é‡æ›´é‡è¦ï¼Œçœ‹ç›®æ ‡æ˜¯ä»€ä¹ˆ
	2. ç®—åŠ›å……è¶³çš„æƒ…å†µä¸‹ï¼šå¯é€‚å½“ä¸Šé‡‡æ ·é«˜è´¨æˆ–domainæ•°æ®ï¼Œæå‡ç‰¹å®šèƒ½åŠ›
16. åˆæˆæ•°æ®ï¼š600å¡L20+96å¡H800ï¼šæ¯å¤©1B
17. å…³äº9b-014çš„è®­ç»ƒï¼š
	1. stage1ä»85wåˆ°136wå…±2Tçš„tokenï¼ŒLRä»2.85e-4é™åˆ°äº†1.32e-4ï¼ˆé™1.53ï¼‰ï¼Œæ–œç‡é«˜äº†ã€‚å’Œstage2çš„1.8T tokenä»1.32e-4é™åˆ°0.æ–œç‡ç±»ä¼¼ï¼Œç»™stage2çš„LRè°ƒæ•´ç©ºé—´å°äº†ã€‚
18. ç”¨å¬å›ç‡åˆ¤æ–­å­¦ä¹ åŒºï¼Œåˆ¤æ–­æ˜¯baseæ¨¡å‹èƒ½åŠ›ä¸è¶³è¿˜æ˜¯SFTèƒ½åŠ›ä¸è¶³ã€‚
19. MoE vs Denseä¸€ä¸ªå¯¹æ¯”è§’åº¦ï¼šäººè„‘åªæ¿€æ´»ä¸€éƒ¨åˆ†å‚æ•°ã€‚

éèˆ’é€‚åŒºã€codeã€Pretrainæ•°æ®å’Œlong contextã€è¯­éŸ³å¤šæ¨¡æ€ï¼Ÿ
2. å†›å¸ˆåšå“ªäº›æ•°æ®çš„äº‹ï¼Ÿå·¥ç¨‹çš„äº‹ï¼Ÿ
### TODO
1. [ ] x
2. [x] codeï¼šå’Œqwenç›¸å½“ã€long thought codeã€code Pretrain âœ… 2025-01-17
3. [x] liwu codeæ•°æ®æ€»é‡ï¼ˆ400Bå·¦å³ï¼‰ï¼Ÿ âœ… 2024-12-06
4. [x] 5.7tçš„å¢é‡æ•°æ®æ„å»º âœ… 2025-01-13
5. [ ]
6. [ ] Pretrainæ•°æ®é˜²æ±¡æŸ“
7. [ ] fine-web-2çš„å¤šè¯­è¨€ã€nv Nemotron-CCã€æ¸…åå¼€æº
8. [ ] pdfè§£æï¼špaddle-detectã€got-ocrã€‚å›¾ç‰‡æ ‡é¢˜ã€é¡µçœ‰é¡µè„šã€å…¬å¼/è¡¨æ ¼/å›¾ç‰‡
9 [ ] æ‰€æœ‰æ•°æ®çš„é¢†åŸŸåˆ†ç±»
90 [ ] æ–‡è°¦çš„devæŠ€æœ¯æ–‡æ¡£ï¼ˆdev.ioï¼‰
91 [ ] 5ä¸ªbertï¼šzh/en common/math bertï¼Œå°è¯­ç§bertå’Œcode bert
92 [ ] ~~é‡‡è´­ç”µå­ä¹¦è‹±æ–‡å’Œå°è¯­ç§ï¼›weixinå™ªå£°å¤„ç†ï¼›k12ä¿®å¤ï¼ˆæœ¬å‘¨ä¿®å¤å®Œï¼‰~~ï¼›~~luban cc bertè¡¥æ•°æ®ï¼ˆè¿˜éœ€è¦å»é‡å’Œ12åˆ†ç±»ï¼Œæœ¬å‘¨å¤„ç†å®Œï¼‰ï¼›URLå»é‡åˆç†æ€§ï¼ˆccæ•°æ®åšå®éªŒï¼‰ï¼›å¢é‡æ•°æ®é•¿bertæ‰“æ ‡join~~ã€‚
93 [x] é™¤äº†bertï¼Œweixinï¼ˆ7bè¿‡æ»¤ï¼‰ã€zhidaoï¼ˆé˜ˆå€¼ç¡®è®¤ï¼‰å’Œbookï¼ˆæ®µè½å’Œå¥å­å»é‡ï¼‰ã€‚liwu codeã€‚ âœ… 2024-11-22
94 [x] åˆæˆï¼šlihan knowledgeã€yubo code âœ… 2024-11-22
95 [x] long contextï¼šè¯„ä¼°ã€å·¥ç¨‹ã€æ•°æ®ï¼ˆå¦‚ä½•é…æ¯”ï¼‰ã€rope âœ… 2024-11-22
96 [x] weixinçš„å¥å­å»é‡ï¼šå¥å­å»é‡æ•ˆæœè¿­ä»£ã€‚**å¤§æ¨¡å‹å¥å­å»é‡** âœ… 2024-11-22
97 [x] épdfçš„bookã€zhidaoå’Œweixin âœ… 2024-11-22
98 [x] htmlçš„mathæŠ½å– âœ… 2024-10-18
19 [x] ä¸­æ–‡bert math/codeã€mathç¿»è¯‘é”™çš„ã€codeåˆæˆ âœ… 2024-11-29
90 [x] å»é‡tokenizerçš„æ•ˆæœ âœ… 2024-10-11
91 [x] ä¼ æ•°æ®ç”³è¯·a6000 âœ… 2024-10-11
92 [ ]
93 [ ] åˆ·åˆ†ç»éªŒåŸºäºcaseçš„æ€»ç»“
94 [ ] ccçš„ä¼˜å…ˆä¿ç•™é€»è¾‘ï¼šdclmå’Œrefinweb-edu
95 [ ] æ®µè½å»é‡å’Œå¥å­å»é‡ä¼˜åŒ–
96 [ ] cooperè¡¨ä¸­çš„ä¸‹ä¸ªæ˜ŸæœŸå¤„ç†å®Œï¼šæ–°é‡‡è´­çš„è¦æ¥
	1. [ ] liwuï¼šé˜¿é‡Œäº‘ç”µå­ä¹¦ã€1.3té—®ç­”
	2. [ ] å¹³è¡Œè¯­æ–™æ•°æ®
9. [ ] bertè´¨æ£€å›æï¼šç­›é€‰ï¼ˆdropçš„å–4-5ï¼Œæœªdropçš„å–3-5ï¼‰å’Œå»é‡
10. [ ] bookæ•°æ®ï¼šzlibç­‰
	1. [ ] epubï¼Œpdfã€mobiã€fb2æ ¼å¼æ¸…æ´—
	       epubï¼š473w pdfï¼š1072w mobiï¼š118w azw3ï¼š60w fb2ï¼š80w txtï¼š12w other(lit,rtf,lrf)ï¼š27w
	2. [ ] OCR
	3. [ ] å†›å¸ˆå‘case
11. [ ] liwuçš„è®ºå›æ•°æ®ã€vikp
12. [ ]
13. [ ] cooperçš„è¿‡æ»¤æ•°æ®ç»Ÿè®¡ï¼Ÿé˜ˆå€¼é€»è¾‘æ•´ç†å’Œå¯é…ç½®åŒ–ï¼Ÿ
14 [ ] å¤§æ¨¡å‹è¿‡æ»¤å’Œåˆ†ç±»tag
	1. [x] enå’Œå¤šè¯­è¨€ âœ… 2024-08-16
	2. [ ] 6p ccæ‰“tag
14. [ ]
15. [ ] äºŒé˜¶æ®µlong contextå®éªŒã€åˆ·åˆ†å®éªŒï¼ˆç”¨trainsetå’Œä»¿å†™æ•°æ®ï¼‰ã€9bçš„ç»“æ„å®éªŒ
16. [ ]
17. [x] MAP-CCã€refine-eduã€6P CCæ•°æ®ä¸­/è‹±æ–‡ã€å­˜é‡20T CCï¼Œèµ°æµç¨‹ï¼Œæ‰“tagå’Œå¤§æ¨¡å‹è¿‡æ»¤ âœ… 2024-08-23
18. [ ]
19. [ ] llama3 tokenizerè·‘1.5b task42ï¼šæ€€æ¥
20. [ ] 1.5bæµ‹v3.1ï¼ˆ**å‰”é™¤ä½è´¨å¤æ–‡æ•°æ®ã€è‹±æ–‡é«˜è´¨è¿‡æ»¤æ•°æ®**ï¼‰ï¼šbaichuan2 tokenizer
21. [ ] ct
	1. [ ] æ•°æ®ï¼š
		1. [ ] **å‰”é™¤ä½è´¨å¤æ–‡æ•°æ®ã€è‹±æ–‡é«˜è´¨è¿‡æ»¤æ•°æ®**ã€è‹±æ–‡å‚ç±»æ•°æ®
		2. [ ] **P0ï¼š**llama3å¬å›ç‡ä½çš„æ•°æ®**ï¼š25bä¸­æ–‡token
		3. [ ] replayä¸­è‹±æ–‡æ¯”ä¾‹ï¼šå¤šè·‘ä¸€äº›stepçœ‹çœ‹
		4. [ ] æ•°å­¦å’Œcodeçš„é…æ¯”æé«˜
		5. [ ] é‡‡è´­ä¸­æ–‡æ•°æ®ï¼šç™¾ç§‘ã€çŸ¥ä¹ã€æ•™æ
	2. [ ] lr decayï¼š
		1. [ ] **P1ï¼šè°ƒå° constant**
		2. [ ] çº¿æ€§decay
	3. [ ] æ‰©å……tokenizerï¼š**TODOï¼šP1ï¼šå°½å¿«è¯„ä¼°å‡ºæ•ˆæœ**
		1. [ ] Embeddingåˆå§‹åŒ–
		2. [ ] å†»ç»“éƒ¨åˆ†å±‚
22. [ ] moeè·‘llama3 8b
23. [ ] 34bé€€ç«
24. [ ]
25. [ ] fp8è®­ç»ƒ
26. [ ] MLA moeåŠ é€Ÿ
27. [ ] Quiet Attentionã€BS rampupå®éªŒ
28. [ ] åŠ ä¸Štbçš„æ¯å±‚normç›‘æ§
29. [ ] 34bä¸­æ–‡è¯„ä¼°é—®é¢˜
30. [ ] llama3çš„2tæ•°æ®æ˜¯å¦ä½¿ç”¨çš„è¯„ä¼°
31. [ ] ä¸šç•Œctçš„æ–¹æ¡ˆè°ƒç ”
32. [ ]
33. [ ] æ•°æ®V3
	1. [ ] ä¸­æ–‡ï¼š
		1. [ ] è¿‡æ»¤å¤æ–‡
		2. [ ] è¿‡æ»¤æ”¿æ²»æ•æ„Ÿå’Œè‰²æƒ…ç±»
	2. [ ] è‹±æ–‡ï¼š
		1. [ ] llama2 7b ccè¿‡æ»¤
		2. [ ] math
		3. [ ] code
34. [ ] ä¸­æ–‡SFT llama3 8b
35. [ ] ç±»ä¼¼stability 1.6bçš„å¤šepochå®éªŒ ğŸ”¼ ğŸ“… 2024-04-23
36. [ ] uPå‚æ•°è¿ç§»ç†è®ºã€cpmçš„ä¸€äº›è¶…å‚å®éªŒã€å°å‚æ•°å®éªŒ ğŸ”º
37. [ ] è¶…å‚ä¼˜åŒ–ï¼š
	1. [ ] **LRï¼šæ›´å¤šé˜¶æ®µé€€ç«**
		1. [ ] task64 20wæ­¥ä»¥å å¤šæ¥å‡ ä¸ªé˜¶æ®µï¼ˆå°±æ’å®šå’Œä¸‹é™å¤šäº¤æ›¿å‡ æ¬¡ï¼‰ï¼Œç„¶åæ˜¯7Bçš„ç‰ˆæœ¬å®éªŒ
		2. [ ] task62çš„ç¬¬ä¸‰é˜¶æ®µè®©lrä¸€ç›´é™
		3. [ ] adamå¯¹å‚æ•°æ›´æ–°çš„è¯¦ç»†é€»è¾‘
	2. [x] **deepnorm** âœ… 2024-04-16
		1. [x] è°ƒè¯•alphaã€lrç­‰è¶…å‚ âœ… 2024-04-16
		2. postNormçš„gnç¡®å®æ›´å°äº†ï¼Œä½†æ•ˆæœæ˜æ˜¾å˜å·®ï¼Œæ¢¯åº¦æ¶ˆå¤±ï¼Ÿ
38. [ ] æ¨¡å‹ç»“æ„ï¼š
	1. [ ] **MOE**
		1. [ ] 1.5b\*8 MOEçš„paramè¿›å…¥ç¨³æ€ï¼Œåšç»§ç»­è®­ç»ƒ
		2. [ ] moe balanceã€expertç­‰è¶…å‚å®éªŒ
		3. [ ] upcyclingç»§ç»­è®­ç»ƒ
		4. [ ] 7b MOE
	2. [ ] Long Context
		1. [ ] é•¿æ–‡æœ¬upsampling
			1. [ ] é•¿æ–‡æœ¬æ„å»ºï¼š
				1. å›°æƒ‘åº¦å·®å¼‚æŒ‡æ ‡ä¸»è¦è®¡ç®—ä¸¤æ®µæ–‡æœ¬ä¹‹é—´çš„æ¡ä»¶æ¦‚ç‡ï¼Œå…¶ä¸­S1æ˜¯åœ¨S2ä¹‹å‰çš„æ–‡æœ¬ï¼Œå½“ä¸¤ä¸ªæ–‡æœ¬å¼ºç›¸å…³æ—¶ï¼Œæ¡ä»¶æ¦‚ç‡å€¼å¤§äºå•ç‹¬è®¡ç®—S2çš„æ¦‚ç‡ï¼Œå›°æƒ‘åº¦å·®å¼‚å€¼ä¸ºè´Ÿå€¼ã€‚ï¼ˆç”¨èµµç€šçš„NSP bertï¼Ÿï¼‰
		2. [ ] **dataloaderä¼˜åŒ–**ï¼š
			1. [ ] repoç­‰åœ¨åŒä¸€ä¸ªglobal batch
		3. [ ] NTKã€ROPEç±»å¤–æ¨å®éªŒ
	3. [ ] 1.5bå®½çŸ®å®éªŒ
39. [ ] data-centricï¼š
	1. [ ] V3æ•°æ®æ„å»ºğŸ”º
		1. [ ] 400Mæµ‹è¯•
	2. [ ] **é‡‡ä¹°ã€åˆæˆã€æ”¹å†™æ•°æ®**
		1. [ ] 3.4äº¿é—®ç­”ï¼Œ1åƒ6ç™¾ä¸‡æ–‡ç« 
	3. [ ] æå‡æ¨ç†å’Œè§„åˆ’èƒ½åŠ›ï¼š
		1. [ ] **mathæ•°æ®æ¸…æ´—å’ŒNorm**
	4. [ ] continual Pretrain å¤šé˜¶æ®µè®­ç»ƒ
		1. [ ] 13b-task001çš„æ¨ç†å¢å¼ºï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ï¼šæ•°æ®normåŒ–ï¼ˆcodeã€mathï¼‰ ğŸ“… 2024-03-15 ğŸ”¼
		2. [ ] task42æˆ–62çš„åŸºç¡€ä¸Šï¼Œå¢é‡è®­å‰©ä¸‹çš„1Tï¼Œç§¯ç´¯å¢é‡è®­æ•°æ®é…æ¯”çš„ç»éªŒ
	5. [ ] In Context Pretrainï¼ˆå†è·Ÿæ™‹é£çœ‹æ•°æ®ï¼‰ğŸ”º
	6. [ ] æ•°æ®é…æ¯”å®éªŒ
		1. [ ] **ç±»ç›®tagç»†åˆ†**ï¼ŒReference modelï¼Œdoremiè®­ç»ƒå¼€å‘ ğŸ“… 2024-03-15 ğŸ”º
			1. [ ] åŸºäºlossï¼šdoremiã€[ODMï¼ˆbatch-mix+MABï¼‰](https://arxiv.org/pdf/2312.02406.pdf)
			2. [ ] åŸºäºgrad
		2. [ ] Latent topicï¼šå±‚æ¬¡åŒ–èšç±»ä¸­å¿ƒ+å€’æ’ç´¢å¼•
		3. [ ] è®­ç»ƒåŠ é€Ÿï¼šsample importanceå±‚æ¬¡åŒ–æ„å»º
	7. [ ] **Pipelineï¼šè¯­ä¹‰ç›¸ä¼¼åº¦å»é‡** â« ğŸ“… 2025-05-07
	8. [ ] å¹³è¡Œè¯­æ–™ï¼šfbæ— ç›‘ç£ç¿»è¯‘è®ºæ–‡
	9. [ ] ä¸­æ–‡æ¨¡å‹çš„æ¢³ç†ï¼Œå°¤å…¶Pretrainé˜¶æ®µï¼Œæ•°æ®é…æ¯”å¦‚ä½•ï¼Ÿ
	10. [ ] bookç­‰é•¿æ–‡æœ¬å»é‡é—®é¢˜ï¼šåŸºäºæ®µè½ï¼Ÿ
		1. [ ] è¿˜æ˜¯ç»§ç»­minhashLSHæ¥åšï¼Œå‹ç¼©æ¯”é«˜ä¹Ÿè¡Œï¼Œä¿è¯å¤§é‡é‡å¤æ‰ä¼šè¿‡æ»¤

---
ä¸€äº›ç»“è®ºï¼š
1. å¢åŠ egsç ´åEmbeddingå±‚æ›´æ–°èŠ‚å¥ï¼Œæ•ˆæœè´Ÿå‘
2. deepnormï¼ˆPostNormï¼‰çš„gradnormå˜å°ï¼Œä½†æ•ˆæœå½±å“æ›´å·®
	1. åŠ shortcutï¼Œshortcutä¸‹ä¼ çš„æ¢¯åº¦ä¸€èˆ¬ä¼šæ¯”è¾ƒå¤§

---

### å®éªŒåˆ†æï¼š
#### 1. Dense
| ç‰ˆæœ¬                                                                  | è‡ªå»ºeval            |                   | å¤‡æ³¨                                                                                                                                    |
| :------------------------------------------------------------------ | ----------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                     | ä¸­æ–‡ï¼ˆtop1/5ï¼‰        | è‹±æ–‡                |                                                                                                                                       |
| Baichuan2 7Bï¼ˆ660Bï¼‰                                                  | 0.6706	**0.4307** | 0.7816	**0.5843** |                                                                                                                                       |
| å¤ç°pythiaï¼ŒéªŒè¯megatronæ¡†æ¶ - task014                                     |                   |                   |                                                                                                                                       |
| ä¸­æ–‡v1.1ï¼ˆskypileå’Œwanjuan-webå»é‡ï¼‰- task016                              | 0.5939	0.368      | 0.7116	0.5039     |                                                                                                                                       |
| - 7b-task000                                                        | 0.6297	0.3986     | 0.7478	0.5433     |                                                                                                                                       |
| Base task016ï¼Œå¢åŠ flan_v2å’Œwanjuan exam-cn - task19                     |                   |                   |                                                                                                                                       |
| ä¸­æ–‡V2ï¼ˆæ‰€æœ‰ä¸­æ–‡è¿‡æ»¤å’Œå»é‡ï¼‰- task23                                             |                   |                   |                                                                                                                                       |
| **ä¸­æ–‡V2+è‹±æ–‡V2**çˆ¬è™«é‡‡æ ·43% - task29                                       | 0.6072	0.3798     | 0.742	0.5377      |                                                                                                                                       |
| ä¸­æ–‡v2+è‹±æ–‡v2ï¼ˆå¢åŠ en_wiki/en_flan/å‚ç±»æ•°æ®ï¼‰çˆ¬è™«é‡‡æ ·43% - **task30**               | 0.6138ã€0.3883     | 0.7431	0.5432     |                                                                                                                                       |
| æ•°æ®åŒtask30 - 7b-**task002**                                          | 0.6553	**0.4202** | 0.7771	**0.5803** |                                                                                                                                       |
| - Base 7b-task002 ä»gnä¸Šæ¶¨çš„6w5å¼€å§‹reshuffle                              |                   |                   | ä»ç„¶ä¸Šæ¶¨ï¼Œè¯´æ˜ä¸Šæ¶¨å’Œæ•°æ®è´¨é‡æœ‰å…³ï¼ŒåŒæ—¶ä¸Šæ¶¨æœ¬èº«åœ¨åæœŸæœ‰åˆç†æ€§                                                                                                        |
| Base task30+ç»§ç»­é™ä½lræ•°æ®è¿‡ä¸¤é - task32                                    | 0.6151	0.3897     | 0.7456	0.5443     | ç›¸æ¯”task30æå‡0.1ppï¼Œ**æ€§ä»·æ¯”ä¸é«˜**ï¼Œè¯´æ˜æ˜¯æ¨¡å‹å®¹é‡å—é™ï¼ŒROIæœ‰é™ã€‚ä¸€ä¸ªepochåçš„é‡å¤å’Œä¸€ä¸ªepochå†…çš„é‡å¤è¿˜æ˜¯ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºç¬¬äºŒä¸ªepochå¼€å§‹æ•ˆæœåŸºæœ¬æ²¡ä¸‹é™ã€‚å‚ç±»å°æ¨¡å‹ä¸€èˆ¬è®­å¤šä¸ªepochå› ä¸ºæ›´é‡è®°å¿†ã€è½»æ³›åŒ–ï¼Œè€Œä¸”æ¨¡å‹å‚æ•°ç›¸å¯¹è®­ç»ƒæ•°æ®æ›´å¤§ã€‚ |
| Base task30+æ–°å¢10%çš„wiki/QA/baikeä»è·‘task30çš„æœ€å3wæ­¥ - task34              | 0.6138	0.3883     | 0.7431	0.5432     | æœ€åç®€å•å¢åŠ é«˜è´¨é‡æ•°æ®æ¯”ä¾‹ï¼Œæ²¡å‘æŒ¥ä½œç”¨                                                                                                                   |
| éçˆ¬è™«ä¸­æ–‡+è‹±æ–‡v2ï¼ˆç±»ä¼¼GPTæ¯”ä¾‹ï¼‰ - task35                                        | 0.5411	0.3367     | 0.752	0.5529      | ä¸­æ–‡ä¸¥é‡ä¸‹é™5.2ppï¼Œè‹±æ–‡æå‡1ppï¼Œæ•ˆæœä¸€èˆ¬                                                                                                              |
| éçˆ¬è™«ä¸­æ–‡+è‹±æ–‡v2çˆ¬è™«é‡‡æ ·43% - task36                                          | 0.5556	0.3463     | 0.7236	0.5207     | ä¸­æ–‡ä¸‹é™4.2ppï¼Œè‹±æ–‡ä¸‹é™2.3ppï¼Œ**è¯´æ˜ä¸­è‹±æ–‡çˆ¬è™«éƒ½éœ€è¦**                                                                                                    |
| Base task36+å¢åŠ codeæ¯”ä¾‹ - task38                                       |                   |                   | æ²¡è·‘å®Œã€‚ï¼ˆplanningæˆ–æ¨ç†ï¼Œæ¨ç†å°è¯´ã€æ¸¸æˆæ–‡æ¡ˆç­‰ï¼‰                                                                                                          |
| ä¸­æ–‡v2.2ï¼ˆbaichuan2æ´—æ•°æ®ï¼‰+è‹±æ–‡v2çˆ¬è™«é‡‡æ ·43% - 7b task006                       | 0.6492  0.4144    |                   | ä¸­æ–‡å¬å›ç‡å·®0.6ppï¼Œä½†AlignBenchå’Œä½“æ„Ÿæ˜æ˜¾ç•¥å¥½                                                                                                        |
| **ä¸­æ–‡v2.3**ï¼ˆä¸­æ–‡ä¹¦ã€ç”µä¿¡æ•°æ®ç­‰ï¼‰+**è‹±æ–‡v2.1**ï¼ˆå¢åŠ SEæ•°æ®é‡ï¼‰çˆ¬è™«é‡‡æ ·43%ï¼Œå…±1.1T - 7b task007 |                   |                   | åªè·‘äº†11wæ­¥å·¦å³                                                                                                                             |
| ä¸­æ–‡v2.2+è‹±æ–‡v2 - task39                                                |                   |                   |                                                                                                                                       |
| *ä¸­æ–‡v2 - 13b task000*                                                | *0.6177	0.38*     | *0.5038	0.311*    | *åªç”¨ä¸­æ–‡100B tokenï¼Œ13bç•¥å·®ä¸1.5b*                                                                                                           |
| æ•°æ®åŒ7b task007 - **13B-task001**                                     |                   |                   |                                                                                                                                       |
| æ•°æ®åŒ7b task007 - task 40                                             |                   |                   | æ€»å…±16wæ­¥ï¼Œåªè·‘äº†11wæ­¥ã€‚                                                                                                                       |
| æ•°æ®åŒ7b task006 - task 41                                             |                   |                   | å¯¹æ¯”task30ï¼Œbaichuan2æŠ½å–é«˜è´¨é‡æ•°æ®ä½“æ„Ÿæ›´å¥½äº†ï¼Œç±»ä¼¼7bã€‚å¯¹æ¯”task39ï¼š**ä¸­æ–‡èƒ½åŠ›æ²¡æœ‰ä¸‹é™**ï¼ˆä½“æ„Ÿè¿˜ç•¥å¥½ï¼‰ï¼Œè‹±æ–‡å› ä¸ºæ¯”ä¾‹å˜å¤§çš„åŸå› ï¼Œæ˜æ˜¾å˜å¥½äº†ã€‚                                                   |
| æ•°æ®åŒ7b task007 - task 42                                             | 0.622\|0.3917     | 0.7566\|0.5543    |                                                                                                                                       |
| æ•°æ®åŒ7b task007ï¼Œ**context lengthä¸º4k**ï¼Œå¯¹æ¯”task40 - task043              |                   |                   | æ€»å…±16wæ­¥ï¼Œåªè·‘äº†11wæ­¥ã€‚é€šç”¨æŒ‡æ ‡æœ‰å¥½æœ‰å·®ï¼ˆreasonå¥½åƒå¥½äº†äº›ï¼‰ï¼Œ10wæ­¥æ—¶lossä½0.04.                                                                                  |
| task 42çš„åŸºç¡€ä¸Šæ–°å¢åŠ mathã€codeå’Œpaper - task 45                             |                   |                   | ç›¸å¯¹task42ï¼Œgsm8kå’ŒHumanevalå˜å¥½ã€‚é™¤äº†hellaswagå˜å·®ï¼Œå…¶ä»–æ•ˆæœç±»ä¼¼                                                                                       |
| task 42çš„åŸºç¡€ä¸Šæ–°å¢åŠ redditã€wikiå’Œpaper - task 46                           |                   |                   |                                                                                                                                       |
| æ¨¡å‹æ›´åŠ ç˜¦é«˜ï¼Œå¯¹æ¯”task42 - task49                                            |                   |                   | æ•ˆæœå¾ˆå·®ã€‚åŸå› ï¼šå°æ¨¡å‹å¯èƒ½ä¸»è¦è¿˜æ˜¯é è®°å¿†ï¼Œéœ€è¦æƒ³Gemma 7bä¸€æ ·å¾€å®½äº†åšã€‚                                                                                               |
| 7b task006çš„åŸºç¡€ä¸Šæ–°å¢åŠ mathã€codeå’Œpaperå„10-15B - 7b task008                |                   |                   | ![Pasted image 20240219191623.png](/img/user/990%20Attachment/Pasted%20image%2020240219191623.png)![Pasted image 20240219191718.png](/img/user/990%20Attachment/Pasted%20image%2020240219191718.png) lossä½äº†0.2ppã€‚ç›¸å¯¹task45è´Ÿå‘æŒ‡æ ‡è¾ƒå°‘ï¼Œgsm8kå’ŒHumanevalå˜å¥½ã€‚                |
| å¯¹Embeddingå’ŒPreNormåº•å±‚Layerå¢åŠ weight decayï¼Œå¯¹æ¯”task42  - task50          |                   |                   | æ— æ³•æœ‰æ•ˆé˜»æ­¢gnä¸Šæ¶¨ã€‚                                                                                                                           |
| deepnorm+post LN - task055                                          | 0.5971\|0.3722    | 0.7317\|0.5261    | gnç¡®å®æ›´å°äº†ï¼Œä½†ä»ç„¶ä¸Šæ¶¨ã€‚è‡ªå»ºæŒ‡æ ‡å·®äº†2pp+ï¼Œé€šç”¨æŒ‡æ ‡å´©äº†ï¼Œlossé«˜0.1åˆ°0.2ã€‚                                                                                         |
| å¯¹æ¯”task42ï¼Œå»æ‰codeå’Œyoutubeæ•°æ® - task060                                 |                   |                   | gnæ›´å¤§äº†è€Œä¸”ä¸€ç›´åœ¨ä¸Šæ¶¨ï¼Œæ¯›åˆºåè€Œæ›´å¤šäº†ï¼ˆä¸å¥½è§£é‡Šï¼‰ã€‚lossé«˜0.1åˆ°0.2ã€‚                                                                                              |
| LRé€€ç«å®éªŒ1ï¼Œæ•°æ®åŒtask42 - task62                                          | 0.6297, 0.3982    | 0.7611, 0.561     | lossæ˜¯2.35ï¼Œæ¯”task42ä½0.02ï¼ˆtask42æ˜¯2.37ï¼‰                                                                                                   |
| ä¸­æ–‡v2.3å’Œè‹±æ–‡v2.2ï¼ˆå¢åŠ olmo-ccã€redditã€pes2oï¼‰å…±2Tæ•°æ® - **task64**             | 0.6202\|0.3897    | 0.7588\|0.558     |                                                                                                                                       |
| LRé€€ç«å®éªŒ2ï¼ˆstage3ç»§ç»­é€€ç«ï¼‰ï¼Œæ•°æ®åŒtask42 - task68                              | 0.6301  0.3994    | 0.7618  0.5626    | lossæ˜¯2.34ï¼Œæ¯”task42ä½0.03                                                                                                                |
| ä¸­æ–‡v2.3å’Œè‹±æ–‡v2.2 - 34b task001                                         |                   |                   |                                                                                                                                       |
|                                                                     |                   |                   |                                                                                                                                       |
|                                                                     |                   |                   |                                                                                                                                       |

| æ¨¡å‹å¤§å°      | é«˜   | å®½ï¼ˆhidden sizeï¼‰ | ffn size | é•¿ï¼ˆContext Lenï¼‰ | LRï¼ˆmin-lr 10%ï¼‰ | BS  |
| --------- | --- | -------------- | -------- | -------------- | -------------- | --- |
| 400m      | 12  | 1024           | 2304     | 2048           | 1e-3           |     |
| 1.5b      | 20  | 2048           | 5440     | 2048           | 3e-4           | 4m  |
| 2b        | 26  | 2304           | 9216     | 8k             |                |     |
| 7b        | 32  | 4096           | 10880    | 2048           | 3e-4           | 4m  |
| gemma2 9b | 42  | 3584           | 28672    | 4k/8k          |                |     |
| 9b        | 42  | 3584           | 28672    | 8k             |                |     |
| 13b       | 40  | 5120           | 13824    | 4096           | 3e-4           | 4m  |
| 34b       | 60  | 7168           | 20480    | 4096           | 1.75e-4        | 4m  |
| 72b       |     |                |          |                |                |     |
* BS = `global-batch-size` * `seq-length`

##### 1. 34bçš„ç»éªŒæ•™è®­
1. è®­ç»ƒé—®é¢˜ï¼š
	1. Tokenizeréè‡ªå»º
	2. æ•°æ®è´¨é‡ï¼šgradnormæ¯›åˆºå¤šï¼Œloss spikeä¹Ÿå‡ºç°å¤šæ¬¡
		1. éccæ•°æ®ä¸“é¡¹é˜ˆå€¼è¿‡æ»¤ï¼špaperã€bookã€wikiã€QAç­‰
		2. å‚ç±»æ•°æ®ä¸“é¡¹è¿‡æ»¤ï¼šbase64ç¼–ç ã€htmlã€éä¸­è‹±è¯­æ–™è¿‡æ»¤
		3. æœ€åæ²¡æœ‰æ··å…¥zw-mathã€orca-mathç­‰æ•°æ®
		4. decayæ··Instructæ•°æ®æ··æ™šäº†
			1. åŠ å…¥ph-Instruct-v1åæŒ‡æ ‡åˆå¥½æœ‰å·®
			2. åŠ å…¥K12å’Œzh-paperåï¼Œå¤šæ•°å˜å¥½
	3. LR Scheduleråˆå§‹åŒ–é—®é¢˜ï¼Œåšäº†å¤šæ¬¡è°ƒæ•´ï¼Œä»1.75e-4ï¼ˆcosine lrï¼‰åˆ°1.5e-4ã€‚ã€‚ã€‚
		1. ![Pasted image 20240709154621.png](/img/user/990%20Attachment/Pasted%20image%2020240709154621.png)
	4. dataloaderçš„bugï¼ˆiterè®¾ç½®è¿‡å¤§ï¼‰é€ æˆé‡å¤æ•°æ®çš„é—®é¢˜ã€‚init method std=0.006å¯¼è‡´grad normå’Œlossä¸ç¨³å®šï¼Ÿ
	5. context lengthåªæœ‰4k
	6. bsç»Ÿä¸€ç”¨çš„4M
	7. å…¶ä»–ï¼š
		1. GPUç¡¬ä»¶æ•…éšœã€å„ç§CUDA kernel errors
		2. éƒ¨åˆ†æŠ¥è­¦æ²¡èƒ½æ•æ‰åˆ°ï¼Œå¯¼è‡´GPUç©ºç½®
2. ç»„ç»‡é—®é¢˜ï¼š
	1. ä¸»åŠ¨æ€§å’Œæ‰§è¡ŒåŠ›
3. Pretrainè¿­ä»£é—®é¢˜ï¼š
	1. è¿­ä»£é€Ÿåº¦å¼ºä¾èµ–**Cå’ŒDçš„èµ„æº**
	2. æ›´å¤šæ˜¯æ•°æ®å®éªŒï¼ˆæŠ€æœ¯è®¤çŸ¥æ˜¾è‘—ä¸å¤šï¼‰
	3. è¯„ä¼°æ ‡å‡†çš„é—®é¢˜
#### 2. MOE
1. è¯„ä»·æŒ‡æ ‡ï¼šåŒç­‰æ•ˆæœçš„denseçš„æ¿€æ´»å‚æ•°æ˜¯moeçš„å‡ å€ï¼Œè¶Šå¤§è¶Šå¥½ã€‚
	1. ds moeæ˜¯4å€+
2. Deepseekçš„ä¸€äº›å®éªŒï¼š
	1. moe vs deepï¼šå’Œä¸€åŠå‚æ•°é‡çš„deepæ°´å¹³ç›¸å½“ï¼Œä½†æ¨ç†å’Œè®­ç»ƒæˆæœ¬ï¼ˆactivate å‚æ•°é‡ï¼‰æ˜¯deepä¸€åŠä»¥ä¸‹
		1. moe 2b ~= dense 2b
		2. moe 6bï¼ˆ1.5\*8ï¼‰~= 3b+?
		3. moe 16.4b ~= 7bï¼Œ2.8B for infer, only about 40% of computations
		4. moe 145b ~= 67bï¼Œonly 28.5% (maybe even 18.2%) of computations.
3. mistralï¼š
	1. blogï¼š[Mixtral of experts | Mistral AI | Open-weight models](https://mistral.ai/news/mixtral-of-experts/)

| ç‰ˆæœ¬ | è‡ªå»ºeval |  | é€šç”¨eval |  | å¤‡æ³¨ |
| :--- | ---- | ---- | ---- | ---- | ---- |
|  | ä¸­æ–‡ï¼ˆtop1/5ï¼‰ | è‹±æ–‡ |  |  |  |
| 1.5B-task 42 | 0.622\|0.3917 | 0.7566\|0.5543 |  |  |  |
| 1.5B-moe-task003 |  | 0.7816	**0.5843** |  |  |  |
| 1.5B-moe-task004 |  |  |  |  |  |
### 3. MOD
1. ç”±äºKV cacheçš„åŸå› ï¼ˆæ¯ä¸ªtoken MHAçš„è®¡ç®—ä»…ä¸ºå•tokençš„queryï¼‰ï¼Œè€Œä¸”kv cacheçŸ©é˜µæ˜¯tokenç²’åº¦å¢é‡æ‰©å……çš„ï¼Œä¼šå¯¼è‡´MODæ¨ç†æ—¶å’Œè®­ç»ƒä¸ä¸€è‡´ï¼ˆè®­ç»ƒæ—¶gateèƒ½çœ‹åˆ°æ•´ä¸ªsequenceï¼Œè€Œä¸”æ˜¯attention maskçš„æ–¹å¼è®¡ç®—æ•´ä½“çš„lossï¼‰ã€‚

---

```
1. ç›®æ ‡ï¼šä¸­æ–‡åœºæ™¯ä¸‹ï¼Œfunction callã€reasoningå’Œplanningèƒ½åŠ›
2. æ•°æ®ç±»å‹ï¼ˆ4+1ï¼‰ï¼šCodeã€é«˜çŸ¥ï¼ˆpaper-ArXivã€wikiã€bookï¼‰ã€Q&Aï¼ˆredditã€S&Eï¼‰ã€ç½‘æ–‡çˆ¬è™«ï¼›ç»¼åˆ
3. ä¸–ç•ŒçŸ¥è¯†ï¼šäº‹å®ã€æŠ€èƒ½ã€ç†è®ºçš„æ€»å’Œã€‚
4. å­˜å‚¨ç©ºé—´\/3=Tokenæ•°
5. å¹³è¡Œè¯­æ–™
	1. ccæ•°æ®é‡Œåº”è¯¥æœ‰å¾ˆå¤šå¹³è¡Œè¯­æ–™
6. æ•°æ®ï¼šæˆç«‹æ–°å…¬å¸
	1. é—®ç­”ã€å‡ºè¡Œç›¸å…³
	2. ç¾ä¸œçš„æœºå™¨çˆ¬è™«
	3. åˆæˆæ•°æ®ï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„æ•°æ®åˆæˆ
		1. å®Œå–„æ•°æ®åˆ†å¸ƒä¸­ã€ç¼ºå¤±ã€‘çš„éƒ¨åˆ†

å…­ã€å¤§æ¨¡å‹åŸºç¡€å¹³å°å»ºè®¾æ–¹å‘@å­”å»ºé’¢(kongjiangang)
H1è¾¹å»ºè®¾ï¼Œè¾¹ç”Ÿäº§;H2ææ€§èƒ½ï¼ŒåŠ©è½åœ°;
Q1:
PO. LLabæ”»é˜²ä¸¤ç»„èµ„æºåˆ°ä½å’Œä¿éšœ(H800, A100, L40Så’ŒA6000);
PO.é¢„è®­ç»ƒå››é¡¹æ”¯æŒ:æ•°æ®ç”Ÿäº§ã€å·¥ç¨‹éœ€æ±‚ã€ABå®éªŒ/æ¶ˆèå®éªŒã€è®­ç»ƒæ”¯æŒ;
PO.ä¾æ‰˜MHï¼Œæ‰¿æ¥æ”¯æŒé˜²å®ˆç»„å„æ–¹å‘LLMå¾®è°ƒã€æ¨ç†éƒ¨ç½²å’Œä¼˜åŒ–;
P1.ä¸¤å¤§å­ç³»ç»Ÿå¼€å‘:æ•°æ®æ¸…æ´—å­ç³»ç»Ÿ+MHé¢„è®­ç»ƒï¼Œå®Œæˆé¢„è®­ç»ƒè®­ç»ƒã€è¯„ä¼°æµç¨‹ä¸€æ¡é¾™;

Q2:
PO.å®Œæˆæ•°æ®æ¸…æ´—ç³»ç»Ÿ4åŒ–ï¼Œå¹¶ä¸MHçš„é›†æˆ;(å®Œå¤‡åŒ–ã€è‡ªåŠ¨åŒ–ã€åœ¨çº¿åŒ–ã€å¯è§†åŒ–)
PO. IFX-LLM Ready,è®¡åˆ’ä¼˜åŒ–é¡¹å’ŒåŠŸèƒ½å®Œæˆï¼Œé‡ç‚¹ä¸šåŠ¡æ€§èƒ½è¾¾æ ‡ï¼ŒMHéƒ¨ç½²é»˜è®¤IFX-LLM;(é‡åŒ–ã€èåˆã€FP8ä½ç²¾ã€æŠ•æœºé‡‡æ ·)
P1.é¢„è®­ç»ƒè¿›å…¥åˆ°ä¾‹è¡Œä»»åŠ¡é˜¶æ®µï¼Œæä¾›æœ‰é™èŒƒå›´çš„è‡ªåŠ©æ’æŸ¥ã€è¯Šæ–­èƒ½åŠ›;

Q3:
PO.é¢„è®­ç»ƒä¼˜åŒ–ï¼Œå…±å»ºè¿½æ±‚æ›´å¤§æ¨¡å‹ã€æ›´å°‘æ—¶é—´ã€æ›´å¯é çš„è®­ç»ƒèƒ½åŠ›;
PO.IFX-LLMæŒç»­æ¨è¿›æ”»é˜²ä¸¤ç»„ä»¥åŠå…¶ä»–ä¸šåŠ¡çš„æ¨ç†éƒ¨ç½²ï¼Œæ¡ä»¶å…è®¸æ¨è¿›å¼€æº;
P1. MHå…·å¤‡å¤§æ¨¡å‹å®‰å…¨åˆè§„æ£€æŸ¥è¯„ä¼°èƒ½åŠ›;
P1.å¤§æ¨¡å‹å¤§èµ›æ”¯æŒ;

Q4:
PO. MHå¸å†…æ¨å¹¿ï¼Œè¾¾æˆè¦†ç›–æ”¯æŒ>=95% å¤§æ¨¡å‹æ¨¡å‹ç”Ÿäº§ã€éƒ¨ç½²åœºæ™¯;
PO.é¢„è®­ç»ƒFP16 MFU>=45%;(å½“å‰å€¼39.5%ï¼Œä¼°è®¡ç†è®ºå€¼åœ¨60%);
PO. ä»¥llama-7Bä¸ºå…¸å‹ï¼Œæ¨ç†æ€§èƒ½åœ¨10så»¶è¿Ÿä¸‹ï¼Œå®ç°>=50%(2070tokens/s)ååå¢åŠ ;
å‰
```
---
### æŸ¥GNä¸Šæ¶¨é—®é¢˜

1. https://wandb.ai/ai2-llm/OLMo-7B?nw=nwuserakshitab
2. gnçš„è®¡ç®—ä»£ç 
   ![Pasted image 20231222160319.png](/img/user/990%20Attachment/Pasted%20image%2020231222160319.png)

3. æ¯›åˆºæ•°æ®åˆ†æï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201629244536?sheetId=MODOC)
	1. shuffleæ•°æ®åˆ†å¸ƒåˆ†æï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201374744992?sheetId=lTCQf)ï¼Œå‘ç°shuffleæ²¡é—®é¢˜
	2. shuffleåçš„æ•°æ®åˆ†å¸ƒæ£€æŸ¥ï¼š
		1. åˆ©ç”¨äºŒåˆ†ç±»æ¨¡å‹ï¼ˆfasttextï¼‰æ£€æŸ¥æ¯›åˆºbatchå’Œéæ¯›åˆºbatché—´çš„æ•°æ®åˆ†å¸ƒæ˜¯å¦æœ‰æ˜ç»†å·®å¼‚
4. è®­ç»ƒä»£ç ï¼š
	1. gradnormä»£ç ï¼š[Site Unreachable](https://git.xiaojukeji.com/MachineLearning/Megatron-LM/blob/master/megatron/optimizer/clip_grads.py)
	2. [GitHub - kyegomez/AttentionIsOFFByOne: Implementation of "Attention Is Off By One" by Evan Miller](https://github.com/kyegomez/AttentionIsOFFByOne)
5. 1.5b+600Bå·¦å³çš„æ•°æ®
	1. æ€€ç–‘grad normä¸Šæ¶¨å’Œæ•°æ®é‡å¤æœ‰å…³ï¼Œæ‰‹åŠ¨å¤åˆ¶éƒ¨åˆ†æ•°æ®æºé‡å¤5æ¬¡ï¼Œå’Œå…¶ä»–æ•°æ®æºæ··åˆåï¼Œè·‘äº†10w iterï¼Œæœªè§‚å¯Ÿåˆ°normä¸Šæ¶¨ é“¾æ¥ï¼š[http://10.207.0.177:8058/?darkMode=true#timeseries](http://10.207.0.177:8058/?darkMode=true#timeseries)
	2. pythiaæ¨¡å‹ç»“æœå¤ç°ï¼Œä½¿ç”¨pileå»é‡åçš„æ•°æ®ï¼Œgrad normåœ¨6w iteråå¼€å§‹ä¸Šæ¶¨ï¼Œç»“æœæ­£åœ¨è¯„æµ‹ä¸å¯¹é½ä¸­ é“¾æ¥ï¼š[http://10.191.160.12:8040/?darkMode=true&smoothing=0.91#timeseries](http://10.191.160.12:8040/?darkMode=true&smoothing=0.91#timeseries)
	3. å†…éƒ¨çº¯è‹±æ–‡æ•°æ®è®­ç»ƒï¼Œgrad normåœ¨12w iteråæœ‰ä¸Šæ¶¨ï¼ˆæ•°æ®åœ¨10w iterå·²ç»å…¨éƒ¨è¿‡å®Œï¼‰ é“¾æ¥ï¼š[http://10.191.160.12:8056/?darkMode=true&smoothing=0.91#timeseries](http://10.191.160.12:8056/?darkMode=true&smoothing=0.91#timeseries)
	4. æ•°æ®æ¸…æ´—v1.1ç‰ˆæœ¬ä¸­è‹±æ–‡æ··åˆå®éªŒï¼Œç›®å‰è·‘åˆ°9w iterï¼Œgrad normæš‚æœªä¸Šæ¶¨ï¼Œlossæ›²çº¿å’Œä¹‹å‰æœªå»é‡å·®ä¸å¤ªå¤š é“¾æ¥ï¼š[http://10.207.0.177:8059/?darkMode=true#timeseries](http://10.207.0.177:8059/?darkMode=true#timeseries)
	5. lr 4wæ­¥è¡°å‡é—®é¢˜ï¼š[TensorBoard](http://10.207.0.177:8051/?darkMode=true#timeseries)
	6. lrè¡°å‡ä¿®å¤ï¼š[TensorBoard](http://10.207.0.177:8052/?darkMode=true&smoothing=0.87#timeseries)
	7. å‰”é™¤ccæ•°æ®ï¼š[TensorBoard](http://10.207.0.177:8052/?darkMode=true&smoothing=0.87#timeseries)
	8. å‰”é™¤wanjuanå¤æ–‡bookæ•°æ®ï¼šdoing
	9. åªæœ‰è‹±æ–‡æ•°æ®ï¼š[TensorBoard](http://10.191.160.12:8056/?darkMode=true&smoothing=0.94#timeseries)
	10. æ®µè½å»é‡ï¼š[TensorBoard](http://10.207.0.177:8059/?smoothing=0.84#timeseries)
	11. éªŒè¯ä¸‹megatron-LMæœ‰æ²¡æœ‰å¤§é—®é¢˜ï¼šå¤ç°pythiaå®éªŒ
	12. è·³è¿‡æ•°æ®ï¼Œgradnormæ²¡å˜å¥½
	13. å¢åŠ lrå®éªŒï¼š[TensorBoard](http://10.207.0.177:8061/?smoothing=0.91#timeseries)
		1. è°ƒå¤§lrç›®å‰çœ‹lossä¼˜äºä¹‹å‰çš„æœ€ä¼˜ç‰ˆæœ¬ä¸‡äº”
	14. ä¸­æ–‡v2æ•°æ®ï¼š[TensorBoard](http://10.191.160.12:8001/?darkMode=true&smoothing=0.9#timeseries)
	15. `--reset-attention-mask`ï¼šlosså’Œä½³å“¥è¯„ä¼°é›†æ•ˆæœæ²¡å˜åŒ–
6. å¢åŠ flanä¸­è‹±æ–‡0-shotæ•°æ®ï¼ˆ14bï¼Œå æ¯”2%ï¼‰ï¼šlogprobå˜åŒ–å¾®å¼±ï¼Œä¸‡åˆ†ä½æ³¢åŠ¨
	1. ![Pasted image 20240105170637.png](/img/user/990%20Attachment/Pasted%20image%2020240105170637.png)
7. 9.2wæ­¥å‰åæ¨¡å‹å‚æ•°å¯¹æ¯”ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201517686170)
8. æŸ¥é—®é¢˜ï¼šä»å¤§åˆ°å°çš„å±‚æ¬¡åŒ–åˆ†ægradnorm
	1. ä¸åŒå±‚çš„gradnormæ‰“å°ï¼šä¸åŒsampleä¸åŒå±‚çº§çš„gradï¼Œç›®å‰æ¥çœ‹æ•´ä½“éƒ½æœ‰ä¸Šæ¶¨ï¼Œæ²¡æœ‰æ‰¾åˆ°ç‰¹åˆ«çš„è§„å¾‹ã€‚
		1. ç»“è®ºï¼šæœ‰ä¸Šå±‚æ›´æ–°å¿« ä¸‹å±‚æ›´æ–°æ…¢çš„ç°è±¡ï¼Œä¹Ÿç¬¦åˆé¢„æœŸï¼Œä½é˜¶è¡¨å¾å¾ˆå¿«å°±å­¦ä¹ å¥½äº†ï¼Œé«˜é˜¶è¡¨å¾æ¯”è¾ƒéš¾å­¦ï¼Œéœ€è¦ä¸€ç›´è°ƒæ•´ã€‚
		2. phoenix 13b 001ï¼š![Pasted image 20240221160455.png](/img/user/990%20Attachment/Pasted%20image%2020240221160455.png)
		3. baichuan2 7b baseï¼š![Pasted image 20240221160425.png](/img/user/990%20Attachment/Pasted%20image%2020240221160425.png)
		4. moe 1.5b\*8ï¼š![Pasted image 20240221160710.png](/img/user/990%20Attachment/Pasted%20image%2020240221160710.png)
		5. [TensorBoard](http://10.191.69.151:8001/?pinnedCards=%5B%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22moe+10w+parameter+lm_head.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22moe+10w+parameter+model.embed_tokens.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22moe+18w+parameter+lm_head.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22moe+18w+parameter+model.embed_tokens.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+440B+parameter+model.embed_tokens.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+1100B+parameter+model.embed_tokens.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+440B+parameter+lm_head.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+1100B+parameter+lm_head.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+2200B+parameter+model.embed_tokens.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%2C%7B%22plugin%22%3A%22histograms%22%2C%22tag%22%3A%22baichuan+2200B+parameter+lm_head.weight%22%2C%22runId%22%3A%22defaultExperimentId%2F.%22%7D%5D#timeseries)
	2. æ¨¡å‹æ¯å±‚çš„å‚æ•°å˜åŒ–ï¼šçœ‹äº†ä¸‹9.2wæ­¥gradnormé™¡å¢å‰å2.5kæ­¥checkpointçš„æ¯å±‚çš„å‚æ•°å˜åŒ–ï¼Œæ²¡æœ‰å‘ç°æœ‰æ˜æ˜¾å¼‚å¸¸ï¼ŒåŸºæœ¬è¶Šå¾€åå˜åŒ–è¶Šå°ï¼ˆä¹Ÿå’Œlrä¸‹é™æœ‰å…³ï¼‰
	3. Pre-Normçš„ç›¸å½“äºä»é¡¶å±‚åˆ°åº•å±‚çš„shortcutï¼Œè¿™æ ·ä¸€èˆ¬åº•å±‚çš„gradnormä¼šæ¯”è¾ƒå¤§
9. gradnormä¸Šå‡çš„å¯èƒ½åŸå› ï¼šä¼˜åŒ–å™¨çŠ¶æ€åŒ…æ‹¬mtã€vtç­‰
	1. ![Pasted image 20240403143550.png|200](/img/user/990%20Attachment/Pasted%20image%2020240403143550.png)
	2. ç¢°åˆ°è„æ•°æ®æˆ–é‡å¤ä½è´¨æ•°æ®ï¼ˆå°éƒ¨åˆ†hardæˆ–å™ªå£°æ ·æœ¬ï¼‰ï¼Œgå˜å¤§ï¼Œæ¨¡å‹å‚æ•°åœ¨è¿™äº›batché‡Œè°ƒæ•´è¾ƒå¤§ï¼Œå› ä¸ºLRè¿›ä¸€æ­¥å˜å°+Adamçš„ç´¯ç§¯æ•ˆåº”ï¼ˆåŠ¨é‡ï¼‰ï¼Œè°ƒæ•´æ¨¡å‹å‚æ•°çš„èƒ½åŠ›è¶Šæ¥è¶Šå°ï¼Œå¯¼è‡´è„æ•°æ®å½±å“ä¼šæ¯”è¾ƒä¹…ï¼Œä¸ºäº†ä¼˜åŒ–Thetaï¼ˆæ¨¡å‹å‚æ•°ï¼‰ï¼Œä¸ºäº†ä½¿lossæ›´å°ï¼ŒGNéœ€è¦è¿›ä¸€æ­¥å˜çš„æ›´å¤§ï¼Œæ‰æœ‰å¯èƒ½æŠŠæ¨¡å‹çº æ­£è¿‡æ¥ã€‚
	3. è¿›å…¥åˆ°å¾®è°ƒé˜¶æ®µï¼ˆä¸ºäº†lossä¸‹é™æ›´å…³æ³¨hardæˆ–å™ªå£°ï¼‰ï¼šlrä¸é™ä½ å› ä¸ºè¦æ‹Ÿåˆéƒ¨åˆ†è„æ•°æ®æˆ–hardæ ·æœ¬ lræ²¡æœ‰ç»§ç»­å˜å°é˜»æ­¢ å¯¼è‡´æ¨¡å‹é€æ­¥å˜åæˆ–æ¨¡å‹å®¹é‡å­¦ä¸äº†hard æ¶æ€§å¾ªç¯ gné£äº†ï¼Ÿ
	4. æ¨¡å‹è¿›å…¥ã€å¾®è°ƒåŒºé—´ã€‘çš„**hardæ ·æœ¬çš„ä¿¡å™ªæ¯”**é—®é¢˜
		1. modelè®­ç»ƒè¿›å…¥ å¾®è°ƒæ•´ é˜¶æ®µåï¼Œmodelæ­¤æ—¶ä¸»è¦ä¼˜åŒ–hardæ ·æœ¬ï¼ˆè¿™éƒ¨åˆ†æ ·æœ¬æˆ‘ä»¬çš„æ•°æ®é‡Œå™ªå£°æ›´å¤šï¼‰ï¼Œå¯¼è‡´æ¨¡å‹losså¢å¤§ï¼Œæ­¤æ—¶gnä¸€èˆ¬ä¹Ÿä¼šåŒæ­¥å¢å¤§ï¼Œä½†æ­¤æ—¶**å¦‚æœlrä¸æ–­å˜å°**ï¼ˆlrä¸å˜åº”è¯¥èƒ½ç¼“è§£ï¼Œä½†è¶Šåˆ°åé¢æ¥è¿‘æ”¶æ•›é˜¶æ®µï¼Œè¶Šéš¾æŠ‘åˆ¶gnä¸Šæ¶¨ï¼Œæ¯”å¦‚task62ï¼‰ï¼Œå¯¼è‡´æ¨¡å‹è°ƒæ•´ç¼“æ…¢ï¼Œå¤–åŠ adamçš„ç´¯ç§¯æ•ˆåº”ï¼ˆæŒ‡æ•°ç§»åŠ¨å¹³å‡å†³å®šäº†è¶Šå‰é¢çš„batchå½±å“è¶Šé•¿ä¹…ï¼‰ï¼Œutè¢«æ±¡æŸ“äº†ï¼ˆå¢å¤§$\beta_{1}$ã€$\beta_{2}$ï¼Œlrä¸æŒç»­å˜å°ï¼‰ï¼Œ**gnä¹Ÿéœ€è¦æ›´å¤§çš„è°ƒæ•´ï¼ˆlossé™ä½çš„æœ€ä½³æ–¹å‘å°±æ˜¯gnæ–¹å‘ï¼‰ï¼Œæ‰èƒ½åšåˆ°lossè¿›ä¸€æ­¥å‡å°**ã€‚å¦‚æœæ•°æ®çš„å™ªå£°æ›´å°‘ï¼Œgné£çš„ç¨‹åº¦ä¼šå˜ä½ï¼ˆä¹‹å‰7b 006å¯¹æ¯”002çš„å®éªŒï¼‰ï¼Œè´¨é‡é«˜åˆ°ä¸€å®šç¨‹åº¦ï¼ˆæˆ–å¢å¤§model-ä½†13bæ˜¯ä¸å¤Ÿçš„ï¼Œè°ƒæ•´moeç±»ç»“æ„æå‡æ¨¡å‹è¡¨å¾ç©ºé—´ï¼‰ï¼Œå¯èƒ½å¯ä»¥ä¸é£ã€‚
		2. æ•°æ®æ•´ä½“é…æ¯”é—®é¢˜ï¼šccå æ¯”è¿‡å¤§ï¼ˆ80%+ï¼‰ï¼Œä¸­è‹±æ–‡æ··åˆï¼Œmathã€paperç­‰hardæ•°æ®å½±å“ã€‚
		3. [cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201784789900)
		4. hardæ ·æœ¬ï¼šmathã€paperã€å†·é—¨çŸ¥è¯†ç­‰
			1. 'Min_20.0% Prob'ã€lossæˆ–pplæ¯”è¾ƒé«˜ï¼šè¿˜æœ‰å¯èƒ½æ˜¯è¯¥æ¨¡å‹è®­ç»ƒé›†é‡Œæ²¡æœ‰
		5. é‡åˆ°hardæ ·æœ¬ï¼ˆåŒ…æ‹¬å™ªå£°ï¼‰ï¼Œlosså…ˆæ³¢åŠ¨ã€gnå†æ³¢åŠ¨ï¼ˆä½†è¿˜è·Ÿæ¨¡å‹å‚æ•°æœ‰å…³ï¼‰
			1. pplçš„æ–¹å¼ã€lossçš„æ–¹å¼å’Œgnçš„æ–¹å¼åšæ ·æœ¬è¿‡æ»¤ï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚
			2. ç”¨è‡ªå·±æ•°æ®è®­ç»ƒçš„æ¨¡å‹åšsampleè¿‡æ»¤æœ‰ä¸¤ç‚¹ä¼˜åŠ¿ï¼šsampleæ¯”docæ›´æ¥è¿‘modelï¼ˆä½†é€šç”¨æ€§å·®ï¼‰ã€è‡ªå·±çš„æ¨¡å‹ä¸å­˜åœ¨â€œæ²¡è®­ç»ƒè¿‡â€çš„é—®é¢˜
			3. é£é™©ï¼š**çœŸæ­£çš„hardï¼ˆmathæˆ–paperï¼‰ã€æ¨¡å‹å‚æ•°ï¼ˆè®­ç»ƒæŠ–åŠ¨ï¼‰çš„å½±å“**
			4. çœ‹lossçš„Badcaseè™½ç„¶æœ‰ç¬¬3ç‚¹æåˆ°ã€Œé£é™©ã€è¯¯å·®ï¼Œä½†æ›´æœ‰é’ˆå¯¹æ€§ï¼Œcaseæ”¾å‡ºæ¥ä¹Ÿæ›´æœ‰å†²å‡»åŠ›å’Œè¯´æœåŠ›
	5. é«˜å’Œå®½å®éªŒï¼š
		1. 13bï¼š40 layerï¼Œ5120 hidden
		2. 1.5bï¼š24 layerï¼Œ2048 hidden
		3. MOE 1.5b\*8ï¼š 20 layerï¼Œ5440 hidden
	6. softmax losså’Œgradnormçš„å¤§å°æ˜¯æ­£ç›¸å…³å—ï¼Ÿ

|      | 1.5b | 34bï¼ˆä¸æŠ–åŠ¨ï¼‰ |     |
| ---- | ---- | -------- | --- |
| loss | å¤§    | å°        | æ­£å¸¸  |
|      | å¤§    | å¤§        |     |
|      | å°    | å¤§        |     |
|      | å°    | å°        |     |

### ParamNormä¸Šæ¶¨é—®é¢˜
1. LRä¿æŒå¹³ç¨³ï¼Œå½“å‰batchçš„æ•°æ®åˆ†å¸ƒä¼šå¯¹æ¢¯åº¦å¸¦æ¥æ›´å¤§å½±å“ï¼Œå¯¼è‡´ParamNormä¸Šæ¶¨ã€‚
	1. lrä¸å˜ï¼Œbatch sampleæœ‰åˆ†å¸ƒå˜åŒ–ï¼Œä¸ºäº†å­¦ä¹ æ–°åˆ†å¸ƒï¼Œutä¼šè¾ƒå¤§ï¼ˆå°¤å…¶æ˜¯ä¸Šå±‚å‚æ•°çš„æ¢¯åº¦ï¼‰ï¼Œå¦‚æœut normå¤§äº$\theta_{t-1}\ norm$ ï¼Œä¼šå¯¼è‡´$\theta_{t}\ norm$å˜å¤§ã€‚ä¸”å¦‚æœut normç»å¸¸å¤§äº$\theta_{t}\ norm$ï¼Œç”±äºutçš„ç´¯ç§¯æ•ˆåº”ï¼Œ$\theta_{t+1}\ norm$å°±ä¼šæŒç»­å˜å¤§ã€‚lrè°ƒå°ï¼Œå½“å‰çš„batch sampleå¯¹modelçš„å½±å“æŒç»­é™ä½ï¼Œ$\theta\ norm$å³ParamNormä¼šè¶Šæ¥è¶Šç¨³å®šï¼Œç”šè‡³ä¸‹é™ã€‚
   ![Pasted image 20240823104526.png|300](/img/user/990%20Attachment/Pasted%20image%2020240823104526.png)
2. LRä¸€ç›´ä¸‹é™ï¼Œä¸ºäº†lossé™ä½ï¼ŒåŒæ—¶æ‹Ÿåˆæ–°çš„åˆ†å¸ƒæˆ–hardæ ·æœ¬ï¼Œæ¢¯åº¦æ–¹å‘ï¼ˆgnï¼‰éœ€è¦å¢å¤§

---
1. ç›®å‰çš„æµ‹è¯•é›†ï¼šæ‰¾çš„ä¸­æ–‡instruct+GPT4ç”Ÿæˆ
	1. æ‰¾æ‰€æœ‰æ¨¡å‹éƒ½æ²¡æœ‰è§è¿‡â€œæ•°æ®â€

---
### è¯„ä¼°é›†è¯„ä¼°
1. è¯„ä¼°é›†æ±‡æ€»ï¼š
	1. baseæ¨¡å‹benchmarké›†åˆï¼š
		1. 145308 /nfs/ofs-llab-hdd/users/zhangchaoli/data/merged_eval_datasets.jsonl
	2. é™ˆä½³è¯„ä¼°é›†ï¼š
		* ä¸­æ–‡ï¼š/nfs/ofs-llm-ssd/user/chenjia/project/llama-efficient-tuning/data/flan_gpt4_clean.json ã€æ•°é‡ï¼š1411ã€‘
		* è‹±æ–‡ï¼š/nfs/ofs-llm-ssd/user/chenjia/project/LLaMA-Factory/data/alpaca_gpt4_data_en.jsonã€æ•°é‡ï¼š52669ã€‘
	3. PretrainåŒåˆ†å¸ƒè¯„ä¼°é›†ï¼š
		* wikiä¸­æ–‡ï¼š/nfs/ofs-llab-vortex/flux/dataset_eval/filtered/wiki/zh/lastest_modify_t2s.jsonl
		* wikiè‹±æ–‡ï¼š/nfs/ofs-llab-vortex/flux/dataset_eval/filtered/wiki/en/lastest.jsonl
	4. Instructionè¯„ä¼°é›†ï¼š
		* ä¸­æ–‡ï¼š/nfs/ofs-llab-vortex/flux/dataset_eval/gen_data/regen_difficult_gpt3.5instruct_5000.jsonã€regen_easy_gpt3.5instruct_5000.jsonå’Œevaluate_zh_filter_gpt4turbo_5000.json
		* è‹±æ–‡ï¼š/nfs/ofs-llab-vortex/flux/dataset_eval/gen_data/regen_en_gpt3.5instruct_1w.json
		* è‡ªå»ºè¯„ä¼°é›†ï¼š
		  ![Pasted image 20240522200357.png](/img/user/990%20Attachment/Pasted%20image%2020240522200357.png)
2. gradioä½“æ„Ÿè¯„ä¼°ï¼š
     ```python
     source activate /nfs/ofs-llm-ssd/user/daiyajun/envs/py310/
     cd /nfs/ofs-llm-ssd/user/daiyajun/project/chatbot-assistant/web_server
     python -u phoenix_base_web.py /nfs/ofs-llab-datasets/phoenix/xxx --server_port 8061 --title xxx
     ```
3. é›…å›è¯„ä¼°ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201567070334)
4. é™ˆä½³è¯„ä¼°ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201373721397)
5. critiqueLLMæ¨¡å‹ è¯„ä¼°ï¼š[LLMBench](https://llmbench.ai/align/submit)
6. HF transformersåštokenizerçš„bugï¼š
	1. ç›®å‰ä½¿ç”¨ tokenizer çš„æ–¹å¼æœ‰è¯¯ï¼ˆåªæ‹·è´ä¸€ä¸ª tokenizer.model åˆ°æ¨¡å‹æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ transformers AutoClass åŠ è½½ï¼Œå®é™…æ˜¯**LlamaTokenizerFast class**ï¼‰ï¼Œå¯¼è‡´è¾“å…¥promptä¸­åŒ…å«æŸäº›ç‰¹å®šç¬¦å·åŠç»„åˆæ—¶ï¼Œencode ç»“æœè·Ÿé¢„è®­ç»ƒ tokenizer encode ç»“æœæœ‰å·®å¼‚ï¼Œå½±å“è¯„ä¼°ç»“æœã€‚
7. å…³äºå¬å›ç‡æŒ‡æ ‡ï¼štokenizerè¶Šå°ï¼Œå¬å›ç‡è¶Šå®¹æ˜“æ›´é«˜ï¼Œå› ä¸ºç›¸å¯¹contextä¿¡æ¯æ›´ä¸°å¯Œï¼ˆå› ä¸ºTop1çš„è¯„ä¼°æ–¹å¼æ˜¯å°†çœŸå€¼ä½œä¸ºè¾“å…¥ï¼Œè€Œä¸æ˜¯æ¨¡å‹è‡ªå·±generateçš„ï¼‰ã€‚æ•°æ®è¡¨åä¼šé«˜10pp+ã€‚
8. HFçš„MMLUè¯„ä¼°ï¼š
	1. ![Pasted image 20241028210236.png](/img/user/990%20Attachment/Pasted%20image%2020241028210236.png)

## æ•°æ®pipeline
æ•°æ®æ±‡æ€»ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201519156654?sheetId=MODOC)
	1. 3+3+1ï¼šï¼ˆwiki+book+paperï¼‰+ï¼ˆcc+code+QAï¼‰+ Instruct
		1. å‚ç±»ï¼ˆmathã€æ³•å¾‹ã€é‡‘èã€åŒ»ç–—ã€é…’æ—…ç­‰ï¼‰åˆ†å¸ƒå…¶ä¸­
ä»£ç ï¼š[Site Unreachable](https://git.xiaojukeji.com/phoenix-vortex)
Pipelineä»‹ç»ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201426225494)
å¤§æ•°æ®å¸¦æ¥çš„æŒ‘æˆ˜ï¼š
1. æ•°æ®ä¸‹è½½ï¼š
	1. ofså­˜å‚¨é—®é¢˜ï¼šä¸‹è½½å’Œåé¢è§£æã€å»é‡åˆ†ç¦»ï¼ŒåŒæ—¶å¯¹ofsè¿›è¡Œå†™ã€è¯»å’Œåˆ é™¤ï¼Œä½†ofsåˆ é™¤gcæ—¶é—´æ˜¯7å¤©ï¼Œè™½ç„¶åˆ é™¤ä½†æ˜¯ç©ºé—´ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œå¯¼è‡´éœ€è¦çš„å­˜å‚¨ä¼šä¸€ç›´å¢åŠ 
	2. CPUè®¡ç®—çš„é—®é¢˜ï¼šserverlessæˆ–sparkéœ€è¦å¤§é‡CPUèµ„æºåšè®¡ç®—å¹¶å‘
	3. ç½‘ç»œå®½å¸¦é—®é¢˜ï¼šç³»ç»Ÿéƒ¨å•ç‹¬é‡‡è´­
2. è¿‡æ»¤å’Œå»é‡çš„ç²’åº¦ï¼šdocç²’åº¦ã€**æ®µè½ç²’åº¦ã€å¥å­ç²’åº¦**ï¼ˆå°¤å…¶æ˜¯é¦–å°¾æ ¼å¼ï¼Œå¦‚å¹¿å‘Šï¼‰
3. çº é”™çš„ç²’åº¦ï¼š**æ®µè½ç²’åº¦ã€å¥å­ç²’åº¦ã€è¯å­—ç²’åº¦**
4. é’ˆå¯¹codeå’Œmathçš„ä¸“é¡¹æ¸…æ´—ï¼šä¾èµ–å…³ç³»ã€formatç­‰
### æ•°æ®æŠ½å–
1. pdfè§£æï¼š[https://facebookresearch.github.io/nougat/](https://facebookresearch.github.io/nougat/)
	1. [https://github.com/VikParuchuri/marker](https://github.com/VikParuchuri/marker)

çŸ¥ä¹æ ¼å¼ï¼š
```
æ ‡é¢˜ï¼š<title>\nä½œè€…ï¼š<author>\nå‘è¡¨æ—¶é—´ï¼š<pub_time>\n\n<content>\n\nè¯„è®º1ï¼š<comment1>\nè¯„è®º2ï¼š<comment2>â€¦
```
```
é—®ï¼š<question>\nç­”ï¼šä½œè€…ï¼š<author>\nå‘è¡¨æ—¶é—´ï¼š<pub_time>\n\n<content>\n\nè¯„è®º1ï¼š<comment1>\nè¯„è®º2ï¼š<comment2>â€¦
```
K12æ ¼å¼ï¼š
```
åŒºåŸŸï¼š<region> å­¦æ®µï¼š<period> å­¦ç§‘ï¼š<discipline/subjectName> å¹´çº§ï¼š<gradeName> å†Œæ¬¡ï¼š<volumeName> éš¾åº¦ï¼š<complexValue> é¢˜ç›®ç±»å‹ï¼š<typeValue/question_type/categoryValue/bigType>\né¢˜ç›®ï¼š<question/title>\né¢˜ç›®åˆ†æï¼š<analysis/explain>\nè€ƒå¯ŸçŸ¥è¯†ç‚¹ï¼š<knowledgeNames>\nææ–™ï¼š<material>\nå‚è€ƒèŒƒæ–‡ï¼š<modelEssay>\nå†™ä½œæŒ‡å¯¼:<guide>\nç­”æ¡ˆï¼š<answers>
```

### æ•°æ®Norm
1. Norm
	1. ç§»é™¤docä¸­æ‰€æœ‰çš„ASCII è¡¨ä¸­æ‰€æœ‰ä¸å¯æ‰“å°å­—ç¬¦
	2. ç§»é™¤å¤šä½™ç©ºæ ¼ã€ä¸­è‹±æ–‡æ ‡ç‚¹ç¬¦å·ç»Ÿä¸€ã€ç§»é™¤å¼‚å¸¸çš„å•è¯ï¼ˆåŒ…å«å¼‚å¸¸å­—ç¬¦æˆ–è¶…è¿‡æœ€å¤§é•¿åº¦ï¼‰
	3. æ‰€æœ‰çš„æ•°å€¼normä¸º0ï¼Ÿ
2. æ”¹å†™ï¼š
	1. é—®ç­”æ ¼å¼ã€ä»£ç mdæ ¼å¼ã€æ ‡é¢˜-åŸæ–‡æ ¼å¼

### æ•°æ®è¿‡æ»¤
1. bloomå¼€æºï¼š[data\_tooling/kenlm\_training at master Â· bigscience-workshop/data\_tooling Â· GitHub](https://github.com/bigscience-workshop/data_tooling/tree/master/kenlm_training)
	1. ccnetï¼š[è·³è½¬ä¸­...](https://link.zhihu.com/?target=https%3A//github.com/facebookresearch/cc_net)
2. åŸå§‹æ•°æ®æ±‡æ€»ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201451103627)
	1. åƒè¨€ï¼š[åƒè¨€ï¼ˆLUGEï¼‰| å…¨é¢çš„ä¸­æ–‡å¼€æºæ•°æ®é›†åˆ](https://www.luge.ai/#/)
		1. ç›®å½•ï¼š/nfs/ofs-llab-vortex/flux/dataset_raw/zh/cc/qianyan
	2. ç”µä¿¡ï¼š
3. è¿‡æ»¤æ¼æ–—
	1. è¿‡æ»¤æ–‡æ¡£ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201370158235)
		1. å®‰å…¨æ ‡ç­¾ä¼˜å…ˆçº§ï¼šæ”¿æ²»ï¼è‰²æƒ…ï¼æš´æï¼æœªæˆå¹´ï¼æ¯’å“ï¼èµŒåšï¼è¿ç¦å“ï¼ä½ä¿—ï¼æš´åŠ›
	2. Baichuan lossåˆ†æï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201374744992?sheetId=wOHaz)
		1. [cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/sheet/2201510055060)
	3. è¿‡æ»¤é˜ˆå€¼caseåˆ†æï¼š
		1. è¿‡æ»¤é˜ˆå€¼åˆ†å¸ƒï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201460565572)
	4. stop wordï¼š
		1. https://github.com/goto456/stopwords/tree/master
		2. https://github.com/Alir3z4/stop-words
	5. é»„èµŒæ¯’ï¼ˆflag wordï¼‰ï¼š
		1. https://github.com/thisandagain/washyourmouthoutwithsoap/blob/develop/data/build.json
		2. https://github.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words/tree/master
	6. codeæ¸…ç†ï¼šmathæ•°æ®ç±»ä¼¼
		1. ä»£ç æ•°æ®çš„æ¸…æ´—ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹è§„åˆ™ï¼šhttps://cooper.didichuxing.com/docs2/document/2202114823233
			1. å¼‚å¸¸å­—ç¬¦å¤„ç†ï¼Œåªè¦åŒ…å«å¼‚å¸¸å­—ç¬¦ï¼Œæ•´ä¸ªæ–‡æ¡£ä¸¢å¼ƒï¼Œå¤§çº¦å æ€»ä½“æ•°æ®é›†çš„1%å·¦å³
			2. éä¸­è‹±æ–‡å­—ç¬¦å¤„ç†ï¼Œåªè¦åŒ…å«éä¸­è‹±æ–‡å­—ç¬¦ï¼Œæ•´ä¸ªæ–‡æ¡£ä¸¢å¼ƒï¼Œå¤§çº¦å æ€»ä½“æ•°æ®é›†çš„7%å·¦å³
			3. æ ¹æ®max_line_lengthã€avg_line_lengthè¿›è¡Œåˆç­›ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¿›è¡Œç²¾ç¡®ç­›é€‰å‡ºbase64ç¼–ç 
4. åŸºäºbertè¿‡æ»¤
	1. fineweb-eduæ‰“åˆ†é€»è¾‘ï¼š
		1. é«˜åˆ†docç‰¹ç‚¹ï¼š1. textbook 2. grade school eduï¼ˆå°å­¦æ•™è‚²ç›¸å…³ï¼‰
	2. pipelineï¼š
	3. mathæ•°æ®ï¼ˆå’Œdeepseek-mathå¯¹æ¯”ï¼‰ï¼š
		1. æ•ˆæœå’Œï¼šbase modelèƒ½åŠ›ã€mathçš„æ•°é‡ã€mathçš„ä¸Šé‡‡æ ·æ¬¡æ•° éƒ½æœ‰å…³
5. å¤§æ¨¡å‹è¿‡æ»¤
	1. å¤§æ¨¡å‹ç”Ÿæˆä»£ç æ¸…æ´—è§„åˆ™ï¼š
		1. Programming Every Example: Lifting Pre-training Data Quality like Experts at Scale
	2. å¤§æ¨¡logprobè¿‡æ»¤
		1. DETECTING PRETRAINING DATA FROM LARGE LANGUAGE MODELS
	3. åŸºäºdocï¼š
		1. Data Selection for Language Models via Importance Resampling
		   ![Pasted image 20250112143511.png](/img/user/990%20Attachment/Pasted%20image%2020250112143511.png)
		2. LongWanjuan: Towards Systematic Measurement for Long Text Quality
		   ![Pasted image 20240905194554.png](/img/user/990%20Attachment/Pasted%20image%2020240905194554.png)
	4. åŸºäºsampleï¼š
		1. æ€è·¯ï¼šå…ˆç”¨å°æ¨¡å‹ï¼ˆ2b+ä¸”è®­1Tçš„æ•°æ®ï¼‰è®­ä¸€éï¼ŒæŠŠlossé«˜çš„æ ·æœ¬å‰”é™¤æ‰
		2. é‡åˆ°çš„é—®é¢˜ï¼š
			1. `eod`å™ªå£°ï¼š1.5båŠä»¥ä¸‹çš„å°æ¨¡å‹å¯¹`eod`çš„è®­ç»ƒä¸å……åˆ†ï¼Œå¯¼è‡´å¦‚æœsampleå‰åŠæ®µæ˜¯enï¼ŒååŠæ®µæ˜¯zhï¼Œlossä¹Ÿä¼šå¾ˆå¤§ã€‚
			   ![Pasted image 20240830080854.png|400](/img/user/990%20Attachment/Pasted%20image%2020240830080854.png)
6. å¼€æºkenlmï¼š[edugp/kenlm Â· Hugging Face](https://huggingface.co/edugp/kenlm)
7. badcaseï¼š
	1. pplï¼šå­—å…¸æ•°æ®pplæ¯”è¾ƒä½ï¼ˆè®­ç»ƒæ•°æ®åŒ…å«ï¼Ÿï¼‰ï¼ŒCC.tiger-ccçš„æ•°æ®
		{"text":"camouflage ï¼»'kÃ¦mÉ™flÉ‘:Ê’ ï¼½ v. æ©é¥°ï¼Œä¼ªè£…ï¼ˆto disguise in order to concealï¼‰ n. ä¼ªè£…è®° è”æƒ³è®°å¿†ï¼šcamï¼ˆçœ‹ä½œcameï¼‰ + ouï¼ˆçœ‹ä½œoutï¼‰ + flagï¼ˆæ——å¸œï¼‰ + e â†’ æ‰›ç€æ——å¸œå‡ºæ¥ â†’ ä¼ªè£…æˆé©å‘½æˆ˜å£« â†’ ä¼ªè£…\ncanard ï¼»kÉ™'nÉ‘:rd ï¼½ n. è°£
		è¨€ï¼Œå‡æ–°é—»ï¼ˆa false malicious reportï¼‰è®° è”æƒ³è®°å¿†ï¼šé‡‘ä¸é›€ï¼ˆcanaryï¼‰åœ¨é€ è°£ï¼ˆcanardï¼‰...","meta":{"title":"GREè¯æ±‡ç²¾é€‰â–ª æ–°ä¸œæ–¹å‡ºå›½è€ƒè¯•å›¾ä¹¦ç³»åˆ—","dataType":"zh-book
		s"},"drop_reason":"success","rules_name":"[\"cond_check_number_words\", \"cond_check_short_line\", \"cond_check_character_repetition_removal\", \"cond_check_word_repetition_removal\", \"cond_check_special_characters\", \"c
		ond_check_stopwords\", \"cond_check_flagged_words\", \"cond_check_lang_id\", \"cond_check_perplexity\"]","rules_value":"[1439, 0.0, 0.03657331136738056, 0.049477351916376304, 0.26741130091984233, 0.12856150104239056, 0.0,
		1.7851083874702454, 841.8]","rules_cond":"[true, true, true, true, true, true, true, true, true]"}
	2. lang idï¼š
		{'url': 'https://ichirino.jp/blog/4%E6%9C%881%E6%97%A5%E9%87%91%E6%B3%BD%E8%87%B3%E7%82%89%E5%BA%B5%E7%9A%84%E4%BA%A4%E9%80%9A%E5%B7%B4%E5%A3%AB%E6%AD%A3%E5%BC%8F%E8%BF%90%E8%A1%8C/', 'timestamp': 1679, 'content_language': 'jpn,zho,eng', 'content_type': 'text/plain', 'text': 'ä»4æœˆ1æ—¥é‡‘æ³½è‡³ç‚‰åºµçš„äº¤é€šå·´å£«æ­£å¼è¿è¡Œï¼\nä½†æ˜¯æ¥ç‚‰åºµçš„è·¯ä¸Šè¿˜ä¼šå¸¦æ‚¨è‡³ç™½å±±å¸‚äººæ°”è§‚å…‰æ™¯ç‚¹å”·ï¼\nã€è§‚å…‰æ™¯ç‚¹ä¾‹ã€‘â€»ä¼šä¾å½“æ—¥è½¦ç¨‹æƒ…å†µå¸¦æ‚¨å‚è§‚1ã€œ2ä¸ªæ™¯ç‚¹ï¼Œæ™¯ç‚¹æ— æ³•æŒ‡å®šï¼Œè¯·è§è°…ï¼\næ˜¯åˆ†æ•£äºå…¨å›½é€¾3000é—´çš„ç™½å±±ä¿¡ä»°ç¥ç¤¾çš„æ€»ç¤¾ã€‚\nå‚æ‹œç”¨çš„è¡¨å‚é“é•¿è¾¾250å…¬å°ºä¸¤æ—æœ‰å·¨å¤§çš„æ‰æ ‘,æ¦‰æœ¨ç­‰ã€‚å…¶ä¸­åˆæœ‰ç¥æœ¨çš„ä¸‰æœ¬æ‰,è€æ‰åŠå®ç‰©é¦†å¯ä»¥å‚è§‚ã€‚\næ‰‹å–å·çš„æ°´æµæ‰€åˆ‡å‰²æˆçš„å³¡è°·ã€‚\nç»µä¹‹ç€‘çš„è½å·®è¾¾32mçš„éå¸¸å£®è§‚ï¼Œæœ‰å¯ä¾›è§‚èµç€‘å¸ƒç”¨çš„å±•æœ›å°ä¹Ÿæœ‰å¯å°æœ¨å±‹çš„éœ²è¥åœºã€‚\nä¹Ÿå¯ä»¥ä½“éªŒæ³›èˆŸæˆ–æ˜¯éª‘ç€å•è½¦æ²¿ç€æ²³é“çš„è‡ªè¡Œè½¦ä¸“ç”¨é“ã€æ‰‹å–å³¡é“æ¸¸è§ˆã€‚\n3/18 AM7:30ï½ç”Ÿä¸­ç¶™ï¼ NHKã€ã‚¦ã‚£ãƒ¼ã‚¯ã‚¨ãƒ³ãƒ‰ä¸­éƒ¨ã€æ£®ã®ã‚µã‚¦ãƒŠå±±ç´«æ°´æ˜ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ³ã‚°ãŒç´¹ä»‹ã•ã‚Œã¾ã™ï¼\nã‚¹ãƒãƒ•ã‚§ã‚¹4å¹´ã¶ã‚Šã«é–‹å‚¬â˜…ç™½å±±ã‚¹ãƒãƒ¼ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ«3æœˆ25æ—¥(åœŸ)ãƒ»3æœˆ26æ—¥(æ—¥)ã«ä¸€é‡Œé‡æ¸©æ³‰ã‚¹ã‚­ãƒ¼å ´ã§é–‹å‚¬ï¼ã‚¹ãƒãƒ¼ãƒ©ãƒ•ãƒ†ã‚£ãƒ³ã‚°ãƒ»ç™½å±±ã‚ãã‚°ãƒ«ãƒ¡ãƒ»ç„¡æ–™é›ªéŠã³ãƒ»æ—©é£Ÿã„å¤§ä¼šãªã©ç››ã‚Šæ²¢å±±ï¼', 'drop_reason': 'success', 'rules_name': '["cond_check_number_words", "cond_check_short_line", "cond_check_character_repetition_removal", "cond_check_word_repetition_removal", "cond_check_special_characters", "cond_check_stopwords", "cond_check_flagged_words", "cond_check_lang_id", "cond_check_perplexity"]', 'rules_value': '[254, 0.2, 0.04922279792746114, 0.0, 0.20253164556962025, 0.3425196850393701, 0.0, 0.7728531956672668, 1346.9]', 'rules_cond': '[true, true, true, true, true, true, true, true, true]'}]

```
å¯ä»¥ç†è§£ä¸ºæŒ‰ä¼˜å…ˆçº§ç­›é€‰ï¼Œä¾æ¬¡ä¸ºï¼šï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå‘½ä¸­è¿”å›å¯¹åº”çš„drop_reasonï¼‰ 
1ã€cond_check_perplexityï¼šæµç•…æ€§ã€å¯è¯»æ€§ï¼ˆå°äº1400ï¼‰# è¯å…¸å‘¢ï¼Ÿ
2ã€cond_check_lang_idï¼šè¯­è¨€çº¯åº¦ï¼ˆå¤§äº0.75ï¼‰# æœ‰äº›ä¸¥æ ¼ï¼Ÿå¹³è¡Œè¯­æ–™ä¼šè¿‡æ»¤ï¼Ÿæ–‡è¨€æ–‡ä¸å‡†
3ã€cond_check_flagged_wordsï¼šæ•æ„Ÿè¯ï¼ˆå æ¯”å°äº0.2ï¼‰
4ã€cond_check_stopwordsï¼štrivialè¯ï¼ˆå æ¯”ï¼‰ï¼ˆæš‚æ—¶æ²¡ç”¨ï¼‰
5ã€cond_check_special_charactersï¼šç‰¹æ®Šå­—ç¬¦ï¼ˆemojiç­‰ï¼‰ï¼ˆå æ¯”å°äº0.3ï¼‰
6ã€"character_repetition_length": 10, "character_repetition_max_cutoff": 0.106
	"word_repetition_length": 5, "word_repetition_max_cutoff": 0.19
7ã€cond_check_short_lineï¼šå°äº20ä¸ªå­—çš„çŸ­å¥å æ¯”ï¼ˆå°äº0.5ï¼‰# æœ‰äº›ä¸¥æ ¼ï¼Ÿ
8ã€cond_check_number_wordsï¼šå­—æˆ–è¯çš„ä¸ªæ•°ï¼ˆ[1,100000]ï¼‰# bookï¼Ÿ

TODOï¼š
2. è·¯å¾„ï¼šNormå‰åçš„docè¾“å‡ºã€Filterå‰åçš„è¾“å‡ºã€å»é‡å‰åçš„è¾“å‡º @é™ˆå‡¯
3. ä¸°å¯Œstop wordsã€flagged_wordsã€special words @æœç«‹ @é™ˆå‡¯
4. æ•´ä½“å»é‡è€Œéå•ç±»æ–‡æ¡£å»é‡ @æ™‹é£
5. å»é‡minhashçš„è¶…å‚è°ƒç ” @åˆ˜æ¨
6. å»é‡å¯¹æ¯”æ–‡ä»¶è¾“å‡º @æ™‹é£
7. æ®µè½å»é‡çš„é˜ˆå€¼ @æ™‹é£ @æœç«‹
8. pplæ˜¯å¦é‡è®­
9. fasttextè¯­è¨€è¯†åˆ«æ¨¡å‹ï¼ˆåº”è¯¥è¿˜å¥½ï¼‰
10. è¯—ç­‰short lineè¶…å‚è°ƒæ•´ï¼Œä¹¦çš„number wordsè°ƒæ•´
```

### å»é‡
1. ç‰ˆæœ¬è®°å½•ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201483339639)
2. v2ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201516054846)
	1. docå»é‡
	2. æ®µè½å»é‡ï¼šé‡å¤æ®µè½çš„å­—æ•°å æ€»å­—æ•°çš„æ¯”ä¾‹è¶…è¿‡30%ï¼ˆ70%ï¼‰ï¼Ÿ
		1. é€šè¿‡æ®µè½å»é‡å»é™¤è°ƒ**ç½‘é¡µå¯¼èˆªæ ã€cookieè­¦å‘Šã€è”ç³»ä¿¡æ¯**ç­‰
	3. è¯­ä¹‰å»é‡ï¼ˆSemDeDupï¼‰ï¼šhttps://cooper.didichuxing.com/docs2/document/2201839247847
		1. å¯¹æ•°æ®åšNä¸ªåˆ†ç‰‡ï¼šå¯ä»¥æ¯ç‰‡10-20Gï¼ˆæ˜¾å­˜å¯åŠ è½½ï¼‰ï¼Œå› ä¸ºæ•´ä½“èšç±»ä¸å¯è¡Œ
		2. æ®µè½å‘é‡åŒ–ï¼šæ®µè½åˆ‡æˆ–åˆæˆ512é•¿åº¦ï¼Œbge-largeå‘é‡åŒ–
		3. åˆ†ç‰‡é—´ï¼ŒåŸºäºfaissï¼ŒC_{N}^{2}åšä¸¤ä¸¤ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆæ•ˆæœç±»ä¼¼å…¨å±€å»é‡ï¼Œä¾‹å¤–ï¼šA~=B, A~=C, B!=Cæ—¶å…¨å±€å»é‡ä¼šåªä¿ç•™Bæˆ–Cï¼‰
	4. ä¸­æ–‡bookã€è‹±æ–‡bookå’Œcodeå•ç‹¬å„è‡ªåšå»é‡
	5. å…ˆåŸºäºbge-largeåšEmbeddingï¼ŒåŸºäºå‡†å¬çš„è¯­ä¹‰å»é‡é˜ˆå€¼ï¼Œéœ€è¦è·‘å¤šæ¬¡ã€‚

### æ–‡æ¡£ç±»ç›®æ„å»º
1. æ˜¾å¼ç±»ç›®ä½“ç³»
	1. ç»†ç²’åº¦ç±»ç›®ä½“ç³»æ„å»º
		1. https://cooper.didichuxing.com/docs2/document/2202010402314
	2. åŸºäºLLMæˆ–Bertå¯¹docåšåˆ†ç±»
2. éšå¼ç±»ç›®ä½“ç³»
	1. åŸºäºè¯­ä¹‰èšç±»ï¼Œæ„å»ºäºŒçº§èšç±»ç´¢å¼•ï¼Œå»ºç«‹èšç±»ä¸­å¿ƒå’Œdocçš„å€’æ’ç´¢å¼•ã€‚
	2. åŸºäºè¯¥å€’æ’ç´¢å¼•æ„å»ºåšæ•°æ®æ¢æµ‹ã€åˆ†ææˆ–é…æ¯”å®éªŒ
3. åŸºäºè¯­ä¹‰èšç±»çš„æ•°æ®æ¢æŸ¥&é…å¥—å·¥å…·

![](https://cooper.didichuxing.com/uploader/f/Z5uxpB4Wj2TqJX5s.png?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MTI1NTUzODgsImZpbGVHVUlEIjoiQnF5S3BrS21wcFRHblp0MSIsImlhdCI6MTcxMjU1NDc4OCwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjoxMDAwMDA3MjU0OH0.fm-gA5BDLcU9wFx9ixNVvR5zxiAnS2nsJBXXAfXOXno)
### dataloaderå®šåˆ¶
1. å¦‚æœä¸€ä¸ªæ•°æ®é›†å¾ˆå°ï¼Œå°äº10%çš„æ•°æ®é›†ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªglobal batché‡Œ å¿…é¡»é‡‡æ ·åˆ°10%ï¼Œç„¶åä¸‹ä¸€ä¸ªå’Œä¸‹ä¸‹ä¸ªbatchå°±ä¸é‡‡æ ·ä»–ï¼Œè®©å•æ¬¡çš„æ•°æ®å‡ºç°æ›´å¤šä¸€äº›ï¼Œæå‡å­¦ä¹ çš„æ•ˆç‡
2. å¼•å…¥groupçš„æ¦‚å¿µï¼Œä¸€ä¸ªgroupå¯ä¿è¯æ”¾å…¥åŒä¸€global batché‡Œã€‚ä½†è¿™ä¼šæ”¹å˜ä¸€ä¸ªbatchä¸­çš„æ•´ä½“éšæœºåˆ†å¸ƒæƒ…å†µï¼Œæ‰€ä»¥éœ€è¦å…¶ä»–batché…åˆåšå…¨å±€å‡è¡¡ã€‚
	1. éœ€è¦å†è®­ç»ƒåæœŸå¼•å…¥è¿™ç±»è®­ç»ƒï¼Œä¸ç„¶batchå’Œbatché—´çš„æ•°æ®åˆ†å¸ƒå·®å¼‚å¤ªå¤§ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®š
3. æ•´ä¸ªbookæˆ–repoæ”¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­batchå¸¦æ¥çš„å½±å“
![Pasted image 20240828172307.png](/img/user/990%20Attachment/Pasted%20image%2020240828172307.png)
![Pasted image 20240828172244.png](/img/user/990%20Attachment/Pasted%20image%2020240828172244.png)
### è®­ç»ƒæ•°æ®åˆ†æ
1. sampleä¸­å¹³å‡docé•¿åº¦
	1. ![Pasted image 20240112131058.png](/img/user/990%20Attachment/Pasted%20image%2020240112131058.png)
2. æ–‡æ¡£ç±»åˆ«åˆ†ç±»ï¼š
	1. è®­ç»ƒæ•°æ®ï¼š[Site Unreachable](https://huggingface.co/datasets/jondurbin/airoboros-3.2?not-for-all-audiences=true&row=7)

## æ¨¡å‹è®­ç»ƒ
1. scaling lawï¼š$L(N,D) = \left[\left(\frac{N_c}{N}\right)^{\frac{\alpha_N}{\alpha_D}} + \frac{D_c}{D}\right]^{\alpha_D}$ï¼Œalpha_N = 0.076ï¼Œalpha_D = 0.103ï¼ŒN_c = 6.4e13ï¼ŒD_c = 1.8e13ã€‚
   ![Pasted image 20250221151656.png|330](/img/user/990%20Attachment/Pasted%20image%2020250221151656.png)
2. å®éªŒæ±‡æ€»ï¼š[cooper.didichuxing.com](https://cooper.didichuxing.com/docs2/document/2201236137997)
3. è®­ç»ƒæ¡†æ¶ï¼š[Site Unreachable](https://git.xiaojukeji.com/MachineLearning/Megatron-LM/tree/gpt-dataset-enable-epoch-shuffle)
	1. pytorchå¯¹cudaç¯å¢ƒåšäº†é™æ€ç¼–è¯‘ï¼Œæ‰€ä»¥condaç¯å¢ƒpip installçš„pytorchå°±å¯ä»¥æŒ‡å®šå¯¹åº”çš„cudaç‰ˆæœ¬ï¼Œä¸ç”¨ç®¡lubané•œåƒé‡Œçš„cudaæ˜¯ä»€ä¹ˆç‰ˆæœ¬ã€‚
4. æ¨¡å‹checkpointç›®å½•ï¼š/nfs/ofs-llab-datasets/phoenix
5. MOEè®­ç»ƒï¼š
	1. [GitHub - mistralai/mistral-src: Reference implementation of Mistral AI 7B v0.1 model.](https://github.com/mistralai/mistral-src/tree/main)
	2. [GitHub - mistralai/megablocks-public](https://github.com/mistralai/megablocks-public?tab=readme-ov-file)
	3. [Mixture of Experts Explained](https://huggingface.co/blog/moe#moes-and-transformers)
		1. å…±äº«bottomsï¼ˆåŸå§‹moeé‡Œçš„expertï¼‰ã€weightã€adamã€tokenç²’åº¦ä¿è¯topkçš„è·³å˜æ˜¯å¾ˆå¹³æ»‘çš„
		2. router balanceå’Œtoken droppingä¿è¯expertçš„å¹³è¡¡
6. ç†è®ºï¼š
	1. Tokenizerï¼š[Tokenizer summary â€” transformers 3.0.2 documentation](https://huggingface.co/transformers/v3.0.2/tokenizer_summary.html)
7. å…³äºstage1å’Œstage2ï¼š
	1. stage1æ•°æ®å…¨è¿‡ï¼ˆçŸ¥è¯†å…¨å­¦åˆ°ï¼‰ï¼Œstage2é‡‡åŸåˆ†å¸ƒçš„10%-30%ï¼ˆä¿è¯å’Œ100%åŸºæœ¬åŒåˆ†å¸ƒï¼‰+ è¦åŠ å¼ºçš„çŸ¥è¯†ï¼Œä¸¤è€…æ¯”ä¾‹8:2å·¦å³ï¼Œä¿è¯è®­ç»ƒæ—¶ä¸åç¦»stage1å¤ªè¿œ
8. é¢„è®­ç»ƒè’¸é¦
	1. ç”¨qwen110bå…ˆå¾—åˆ°100bæ•°æ®çš„`top100çš„logit`
	2. å®éªŒç»“è®ºï¼š
		1. è®­ç»ƒæ•ˆç‡æ›´é«˜ï¼šåœ¨å°æ•°æ®é‡ï¼ˆ15bï¼‰+å°modelï¼ˆ1.5bï¼‰ä¸Šlosså’Œé€šç”¨æŒ‡æ ‡
9. 9b 2.8T loss spikeé—®é¢˜æ’æŸ¥ï¼šhttps://cooper.didichuxing.com/docs2/document/2202938632494

---
dd-1.5b
1. **1.9Tè‹±æ–‡æ•°æ®ã€197Gä¸­æ–‡æ•°æ®**

![Pasted image 20231219160935.png](/img/user/990%20Attachment/Pasted%20image%2020231219160935.png)

Ziya2-13b
![Pasted image 20231218164249.png](/img/user/990%20Attachment/Pasted%20image%2020231218164249.png)
* è¯­ç§åˆ†ç±»å’Œæ ‡å‡†åŒ–ã€è´¨é‡åˆ†-PPLå€¼ã€æ•æ„Ÿåˆ†çº§è¿‡æ»¤ã€å»é‡ï¼ˆbloomfilterã€simhashç­‰ï¼‰
	* åˆ†ç±»ã€è¿‡æ»¤ã€å»é‡
	* è¿‡æ»¤ï¼šæ‰‹å·¥å¯å‘å¼è¿‡æ»¤æ–¹æ³•ï¼Œæ¯”å¦‚å†™æ­£åˆ™è¡¨è¾¾å¼
* å®‰å…¨å’Œè„±æ•æ–¹é¢ï¼šPII
* codeå…ˆè®­ï¼Œæ•°å­¦æœ€åè®­ï¼Ÿ
![Pasted image 20231219184910.png](/img/user/990%20Attachment/Pasted%20image%2020231219184910.png)

## Baichuan2

## Qwen

## llama 2
* publicly available data. We also increased the size of the pretraining corpus by 40%ï¼ˆåœ¨2Tä»¤ç‰Œä¸Šè¿›è¡Œé¢„è®­ç»ƒåï¼Œæ¨¡å‹ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºå‡ºä»»ä½•é¥±å’Œè¿¹è±¡ï¼‰, doubled the context length of the model, and adopted grouped-query attention (Ainslie et al., 2023)ï¼ˆæå‡æ¨ç†èƒ½åŠ›ï¼‰.

* METAçš„llamaä»£ç åªä¾èµ–pytorchï¼Œæ²¡ç”¨transformers

* As shown in Table 4, Llama 2 70B is close to GPT-3.5 (OpenAI, 2023) on MMLUï¼ˆç»¼åˆè¯„ä¼°é›†ï¼‰ and GSM8Kï¼ˆæ•°å­¦ï¼‰, but there is a **significant gap on coding benchmarks.** ï¼ˆæ‰€ä»¥åšäº†ä¸ªcode llamaï¼Œ34bå¥½äºgpt3.5ï¼‰

* SFT annotations in the order of tens of thousands was enough to achieve a high-quality result. **SFTå’ŒRLHF 2-5wï¼ŒRM 10w+å°±å¤Ÿäº†**ã€‚

* new technique, Ghost Attention (GAtt), which we find helps control dialogue flow over multiple turns (Section 3.3).

* Surprisingly, we found that the outputs sampled from the resulting SFT model were often competitiveï¼ˆSFTæ¨¡å‹å¯ä»¥å’Œäººå†™çš„ä¸€æ ·å¥½ï¼‰ with SFT data handwritten by human annotators, suggesting that we could reprioritize and devote more annotation effort to preference-based annotation for RLHF. ï¼ˆéœ€è¦RLHFå»æ›´å¤šçš„alignmentã€‚SFTéƒ½æ¯”äººç±»å›ç­”çš„å¥½äº†ï¼Ÿï¼‰

### llama 1

---
1. RMä¸­ï¼Œpå’Œqå¦‚ä½•è®¾è®¡ï¼Œå»é˜²æ­¢ä¸¤è€…çš„å·®è·å¤§ï¼Œå’Œè®­ç»ƒç¨³å®šæ€§ï¼Œpæ˜¯Pretrainçš„Policyã€qæ˜¯sftçš„Policy
	1. RMè®¡ç®—çš„ä¸‰ç§æ–¹å¼ï¼š
2. æ€ä¹ˆè®¾è®¡RMå’Œppo lossä½¿è®­ç»ƒæ›´å¥½

![Pasted image 20231130165122.png](/img/user/990%20Attachment/Pasted%20image%2020231130165122.png)
![Pasted image 20231130165143.png](/img/user/990%20Attachment/Pasted%20image%2020231130165143.png)
![Pasted image 20231130165159.png](/img/user/990%20Attachment/Pasted%20image%2020231130165159.png)

---
Mistral-7B-v0.1 is a transformer model, with the following architecture choices:
* Grouped-Query Attention
* Sliding-Window Attention
* Byte-fallback BPE tokenizer

---
### æ•°æ®å‘¨ä¼š

2024-11-15
todoï¼š
1. weixinçš„dropæ•°æ®è¿‡7b
2. code repoçš„å»é‡é€»è¾‘ä¼˜åŒ–
3. pdfçš„VL ocræ•ˆæœï¼Œå…¬å¼å’Œå›¾æ ‡è½¬æˆlatex
