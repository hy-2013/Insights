<div class="page-sidebar">
  <div class="page-sidebar__inner">
    <div class="page-sidebar__scroll">
      {% for imp in dynamics.sidebar.top %}
        {% include imp %}
      {% endfor %}

      {% if settings.dgShowToc === true %}
        {% set tocHtml = (content and (content | toc)) %}
        {% if tocHtml %}
          <div class="toc">
            <div class="toc-title-container">
              <div class="toc-title">
                Table Of Contents
              </div>
            </div>
            <div class="toc-container">
              {{ tocHtml | safe }}
            </div>
            <script>
              // Remove # symbols from TOC links
              (function() {
                const removeTocHashes = function() {
                  const tocLinks = document.querySelectorAll('.toc-container a');
                  tocLinks.forEach(link => {
                    // Get all text nodes and clean them
                    const walker = document.createTreeWalker(
                      link,
                      NodeFilter.SHOW_TEXT,
                      null,
                      false
                    );
                    
                    const textNodes = [];
                    let node;
                    while (node = walker.nextNode()) {
                      textNodes.push(node);
                    }
                    
                    textNodes.forEach(textNode => {
                      // Remove all # symbols and trim whitespace
                      textNode.textContent = textNode.textContent.replace(/#/g, '').trim();
                    });
                  });
                };
                
                // Run immediately
                removeTocHashes();
                
                // Also run after DOM is fully loaded
                if (document.readyState === 'loading') {
                  document.addEventListener('DOMContentLoaded', removeTocHashes);
                } else {
                  // Run again after a short delay to catch any dynamic content
                  setTimeout(removeTocHashes, 100);
                }
              })();
            </script>
          </div>
        {% endif %}
      {% endif %}

      {% for imp in dynamics.sidebar.bottom %}
        {% include imp %}
      {% endfor %}
    </div>
  </div>
</div>
